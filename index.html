<!DOCTYPE html>
<html lang="az">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HR İdarəetmə Sistemi</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js" integrity="sha512-GsLlZN/3F2ErC5ifS5QtgpiJtWd43JWSuIgh7mbzZ8zBps+dvLusV+eNQATqgA/HdeKFVgA5v3S/cIrLF7QnIg==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
    <style>
        /* --- Basic Reset & Global Styles --- */
        :root {
            --primary-color: #0056b3; /* Göy rəng */
            --secondary-color: #e9ecef; /* Açıq boz fon */
            --text-color: #333;
            --border-color: #ced4da;
            --danger-color: #dc3545; /* Qırmızı */
            --success-color: #28a745; /* Yaşıl */
            --white-color: #fff;
            --font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            --border-radius: 0.3rem;
            --box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: var(--font-family);
            background-color: #f8f9fa;
            color: var(--text-color);
            line-height: 1.6;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background-color: var(--white-color);
            padding: 30px;
            border-radius: var(--border-radius);
            box-shadow: var(--box-shadow);
        }

        h1, h2 {
            color: var(--primary-color);
            margin-bottom: 20px;
            text-align: center;
        }
        h2 {
            margin-top: 30px;
            border-bottom: 1px solid var(--secondary-color);
            padding-bottom: 10px;
        }

        /* --- Form Styling --- */
        #add-employee-form {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
            padding: 20px;
            background-color: var(--secondary-color);
            border-radius: var(--border-radius);
        }

        .form-group {
            display: flex;
            flex-direction: column;
        }

        .form-group label {
            margin-bottom: 5px;
            font-weight: 600;
        }

        .form-group input[type="text"],
        .form-group input[type="number"],
        .form-group input[type="date"],
        .form-group select {
            padding: 10px;
            border: 1px solid var(--border-color);
            border-radius: var(--border-radius);
            font-size: 1rem;
            width: 100%;
        }
        .form-group input:focus,
        .form-group select:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 2px rgba(0, 86, 179, 0.2);
        }
         .form-group input[type="number"]::-webkit-outer-spin-button,
         .form-group input[type="number"]::-webkit-inner-spin-button {
             -webkit-appearance: none;
             margin: 0;
         }
         .form-group input[type="number"] {
            -moz-appearance: textfield; /* Firefox */
         }

        #add-employee-form button[type="submit"] {
            grid-column: 1 / -1; /* Span full width */
            padding: 12px 20px;
            background-color: var(--primary-color);
            color: var(--white-color);
            border: none;
            border-radius: var(--border-radius);
            cursor: pointer;
            font-size: 1.1rem;
            font-weight: 600;
            transition: background-color 0.3s ease;
        }
        #add-employee-form button[type="submit"]:hover {
            background-color: #004494;
        }

        /* --- Employee List Styling --- */
        #employee-list {
            margin-top: 20px;
            overflow-x: auto; /* Add scroll for small screens */
        }

        .employee-table {
            width: 100%;
            border-collapse: collapse;
            min-width: 900px; /* Prevent excessive squishing */
        }

        .employee-table th,
        .employee-table td {
            border: 1px solid var(--border-color);
            padding: 12px 10px;
            text-align: left;
            vertical-align: middle;
        }

        .employee-table thead {
            background-color: var(--primary-color);
            color: var(--white-color);
        }
        .employee-table thead th {
             position: sticky; /* Make header sticky when scrolling */
             top: 0;
             background-color: var(--primary-color);
             z-index: 1;
        }

        .employee-table tbody tr:nth-child(even) {
            background-color: var(--secondary-color);
        }
        .employee-table tbody tr:hover {
             background-color: #d6e6f5;
        }

        .employee-table .actions {
            text-align: center;
            white-space: nowrap; /* Prevent buttons wrapping */
        }

        .employee-table .actions button {
            padding: 6px 10px;
            margin: 0 3px;
            border: none;
            border-radius: var(--border-radius);
            cursor: pointer;
            font-size: 0.9rem;
            transition: opacity 0.3s ease;
        }
        .employee-table .actions button:hover {
             opacity: 0.8;
        }

        .btn-terminate {
            background-color: var(--danger-color);
            color: var(--white-color);
        }

        .btn-contract {
            background-color: var(--success-color);
            color: var(--white-color);
        }
         .btn-vacation {
             background-color: #ffc107; /* Sarı */
             color: #333;
             font-weight: bold;
             padding: 2px 6px;
             margin: 0 2px;
             font-size: 0.8rem;
         }

        .currency::after {
            content: " ₼"; /* AZN Manat simvolu */
        }

        .vacation-controls {
             display: inline-flex;
             align-items: center;
        }
        .vacation-days {
             margin: 0 5px;
             min-width: 20px;
             text-align: center;
             font-weight: bold;
        }


        /* --- Contract Template (Hidden) --- */
        #contract-template {
            font-family: 'Times New Roman', Times, serif; /* Typical contract font */
            padding: 40px;
            border: 1px solid #ccc;
            margin-top: 20px;
            background: white;
            color: black; /* Ensure black text for PDF */
            line-height: 1.8;
            font-size: 12pt;
            /* display: none; Initially hidden */
            position: absolute; /* Take out of flow */
            left: -9999px; /* Hide off-screen */
            width: 210mm; /* A4 width */
            min-height: 297mm; /* A4 height */
        }
        #contract-template h3 {
            text-align: center;
            color: black;
            font-size: 16pt;
            margin-bottom: 30px;
        }
        #contract-template p {
             margin-bottom: 15px;
        }
        #contract-template .contract-section {
             margin-top: 25px;
        }
        #contract-template .placeholder {
            font-weight: bold;
            color: #555; /* Slightly visible placeholder */
            min-width: 100px;
            display: inline-block;
            border-bottom: 1px dotted #999;
            padding: 0 5px;
        }
        #contract-template .signatures {
             margin-top: 50px;
             display: flex;
             justify-content: space-between;
        }
         #contract-template .signature-block {
             width: 45%;
             text-align: center;
             border-top: 1px solid black;
             padding-top: 10px;
         }

        /* --- Responsiveness --- */
        @media (max-width: 768px) {
            .container {
                padding: 20px;
            }
            #add-employee-form {
                grid-template-columns: 1fr; /* Stack form elements */
            }
             .employee-table th,
             .employee-table td {
                 padding: 10px 8px;
                 font-size: 0.9rem;
             }
             .employee-table .actions button {
                 padding: 5px 8px;
                 font-size: 0.8rem;
                 margin: 2px;
             }
        }
        @media (max-width: 480px) {
             body { padding: 10px; }
             .container { padding: 15px; }
             h1 { font-size: 1.8rem; }
             h2 { font-size: 1.5rem; }
              .employee-table th,
             .employee-table td {
                 padding: 8px 5px;
                 font-size: 0.85rem;
             }
              .employee-table .actions button {
                 display: block;
                 width: 100%;
                 margin-bottom: 5px;
             }
        }

        /* --- Utility Classes --- */
        .error-message {
            color: var(--danger-color);
            font-size: 0.9rem;
            margin-top: 5px;
        }
         .warning {
             background-color: #fff3cd;
             color: #856404;
             padding: 15px;
             border: 1px solid #ffeeba;
             border-radius: var(--border-radius);
             margin-bottom: 20px;
             text-align: center;
         }

    </style>
</head>
<body>

    <div class="container">
        <h1>HR İdarəetmə Sistemi (Prototip)</h1>

        <div class="warning">
            <strong>Diqqət:</strong> Bu yalnız bir prototipdir. Məlumatlar brauzerinizdə saxlanılır və təhlükəsiz deyil. Real HR məlumatları üçün istifadə etməyin! DSMF hesablamaları 2025 qaydalarına əsaslanır və dəyişə bilər.
        </div>

        <section id="add-employee-section">
            <h2>Yeni İşçi Əlavə Et</h2>
            <form id="add-employee-form">
                <div class="form-group">
                    <label for="name">Ad Soyad:</label>
                    <input type="text" id="name" required>
                </div>
                <div class="form-group">
                    <label for="position">Vəzifə:</label>
                    <input type="text" id="position" required>
                </div>
                <div class="form-group">
                    <label for="salary">Brüt Əmək Haqqı (AZN):</label>
                    <input type="number" id="salary" step="0.01" min="0" required>
                    <small id="dsmf-calculation-preview" style="margin-top: 5px;"></small>
                </div>
                <div class="form-group">
                    <label for="hire-date">İşə Başlama Tarixi:</label>
                    <input type="date" id="hire-date" required>
                </div>
                 <div class="form-group">
                    <label for="vacation-days">İllik Məzuniyyət Günləri:</label>
                    <input type="number" id="vacation-days" min="0" value="21" required>
                </div>
                 <div class="form-group">
                    <label for="contract-duration">Müqavilə Müddəti:</label>
                     <select id="contract-duration">
                         <option value="Müddətsiz">Müddətsiz</option>
                         <option value="1 il">1 il</option>
                         <option value="6 ay">6 ay</option>
                         <option value="3 ay">3 ay</option>
                         </select>
                </div>
                <button type="submit">İşçini Əlavə Et</button>
            </form>
        </section>

        <section id="employee-list-section">
            <h2>İşçilərin Siyahısı</h2>
            <div id="employee-list">
                <table class="employee-table">
                    <thead>
                        <tr>
                            <th>Ad Soyad</th>
                            <th>Vəzifə</th>
                            <th>İşə Başlama</th>
                            <th>Brüt Maaş (AZN)</th>
                            <th>İşçi DSMF (AZN)</th>
                            <th>İşəgötürən DSMF (AZN)</th>
                            <th>Xalis Maaş (AZN)</th>
                            <th>Ümumi Xərc (AZN)</th>
                            <th>Məzuniyyət Gün.</th>
                            <th>Əməliyyatlar</th>
                        </tr>
                    </thead>
                    <tbody>
                        </tbody>
                </table>
            </div>
        </section>

    </div><div id="contract-template" aria-hidden="true">
        <h3>ƏMƏK MÜQAVİLƏSİ № <span class="placeholder" data-field="contractNumber"></span></h3>

        <p>Bakı şəhəri &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; "<span class="placeholder" data-field="contractDateDay"></span>" <span class="placeholder" data-field="contractDateMonth"></span> <span class="placeholder" data-field="contractDateYear"></span>-cı il</p>

        <p>
            Bir tərəfdən <span class="placeholder" data-field="companyName">[Şirkət Adı Bura]</span> (bundan sonra “İşəgötürən” adlandırılacaq) _______ əsasında fəaliyyət göstərən Direktor <span class="placeholder" data-field="directorName">[Direktorun Adı Soyadı]</span> şəxsində və digər tərəfdən Azərbaycan Respublikasının vətəndaşı
            <span class="placeholder" data-field="employeeName"></span> (Ş.V. № <span class="placeholder" data-field="employeePassport">[ŞV Nömrəsi]</span>, <span class="placeholder" data-field="employeeIssueDate">[Verilmə Tarixi]</span> tarixində <span class="placeholder" data-field="employeeIssueAuthority">[Verən Orqan]</span> tərəfindən verilmişdir, Ünvan: <span class="placeholder" data-field="employeeAddress">[İşçinin Ünvanı]</span>) (bundan sonra “İşçi” adlandırılacaq),
            aşağıdakılar barədə razılığa gələrək bu Əmək Müqaviləsini (bundan sonra "Müqavilə") bağladılar:
        </p>

        <div class="contract-section">
            <strong>1. MÜQAVİLƏNİN PREDMETİ</strong>
            <p>1.1. İşəgötürən İşçini <span class="placeholder" data-field="employeePosition"></span> vəzifəsinə işə qəbul edir.</p>
            <p>1.2. İş yeri: <span class="placeholder" data-field="workLocation">[İş Yerinin Ünvanı]</span>.</p>
            <p>1.3. İşçinin işə başlama tarixi: <span class="placeholder" data-field="hireDate"></span>.</p>
            <p>1.4. Bu müqavilə <span class="placeholder" data-field="contractDuration"></span> müddətinə bağlanılır.</p>
        </div>

        <div class="contract-section">
            <strong>2. ƏMƏK HAQQI VƏ SOSİAL ÖDƏNİŞLƏR</strong>
            <p>2.1. İşçiyə aylıq <span class="placeholder" data-field="grossSalary" class="currency"></span> AZN məbləğində brut əmək haqqı müəyyən edilir.</p>
            <p>2.2. Əmək haqqından qanunvericiliklə nəzərdə tutulmuş vergilər və məcburi dövlət sosial sığorta haqları (DSMF) tutulur.</p>
            <p>2.3. İşəgötürən İşçinin əmək haqqı üzrə qanunvericiliklə müəyyən edilmiş məcburi dövlət sosial sığorta haqlarını ödəyir.</p>
        </div>

         <div class="contract-section">
            <strong>3. İŞ VAXTI VƏ İSTİRAHƏT VAXTI</strong>
            <p>3.1. İşçiyə 5 günlük iş həftəsi müəyyən edilir.</p>
            <p>3.2. İşçiyə ildə <span class="placeholder" data-field="vacationDays"></span> təqvim günü əsas məzuniyyət verilir.</p>
        </div>

         <div class="contract-section">
            <strong>4. TƏRƏFLƏRİN HÜQUQ VƏ VƏZİFƏLƏRİ</strong>
             <p>4.1. İşçinin hüquq və vəzifələri Azərbaycan Respublikasının Əmək Məcəlləsi və Şirkətin daxili intizam qaydaları ilə müəyyən edilir.</p>
             <p>4.2. İşəgötürənin hüquq və vəzifələri Azərbaycan Respublikasının Əmək Məcəlləsi ilə müəyyən edilir.</p>
         </div>

         <div class="contract-section">
             <strong>5. MÜQAVİLƏYƏ XİTAM VERİLMƏSİ</strong>
             <p>5.1. Bu Müqaviləyə Azərbaycan Respublikasının Əmək Məcəlləsində nəzərdə tutulmuş əsaslarla və qaydada xitam verilə bilər.</p>
         </div>

        <div class="signatures">
            <div class="signature-block">
                <strong>İŞƏGÖTÜRƏN:</strong><br/>
                 <span class="placeholder" data-field="companyName">[Şirkət Adı]</span><br/><br/><br/>
                _______________________<br/>
                (<span class="placeholder" data-field="directorName">[Direktor A.S.]</span>)
            </div>
             <div class="signature-block">
                 <strong>İŞÇİ:</strong><br/><br/><br/><br/>
                 _______________________<br/>
                 (<span class="placeholder" data-field="employeeName"></span>)
             </div>
        </div>
    </div>


    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const employeeForm = document.getElementById('add-employee-form');
            const employeeListBody = document.querySelector('#employee-list tbody');
            const salaryInput = document.getElementById('salary');
            const dsmfPreview = document.getElementById('dsmf-calculation-preview');
            const contractTemplate = document.getElementById('contract-template');

            let employees = JSON.parse(localStorage.getItem('employees')) || [];

            // --- DSMF Calculation Logic (Example for 2025 - Needs Verification) ---
            const calculateDSMF = (grossSalary) => {
                grossSalary = parseFloat(grossSalary) || 0;
                let employeeDSMF = 0;
                let employerDSMF = 0;

                // Minumum əmək haqqı (MEH) - 2025 üçün təxmini dəyər (DƏQİQLƏŞDİRİLMƏLİDİR!)
                const minWage = 350; // Bu rəqəm hər il dəyişə bilər!

                // Məcburi Dövlət Sosial Sığorta Haqqı (İşçi tərəfindən)
                // Qeyri-neft, qeyri-dövlət sektoru üçün ümumi qayda:
                if (grossSalary <= 200) {
                    employeeDSMF = grossSalary * 0.03;
                } else {
                    employeeDSMF = (200 * 0.03) + ((grossSalary - 200) * 0.10);
                }

                 // Məcburi Dövlət Sosial Sığorta Haqqı (İşəgötürən tərəfindən)
                 // Qeyri-neft, qeyri-dövlət sektoru üçün ümumi qayda:
                 if (grossSalary <= 200) {
                     employerDSMF = grossSalary * 0.22;
                 } else {
                     employerDSMF = (200 * 0.22) + ((grossSalary - 200) * 0.15);
                 }

                 // İşsizlikdən Sığorta Haqqı (həm işçi, həm işəgötürən 0.5%)
                 const unemploymentInsurance = grossSalary * 0.005;
                 employeeDSMF += unemploymentInsurance;
                 employerDSMF += unemploymentInsurance;

                 // İcbari Tibbi Sığorta (İTS) Haqqı
                 // İşçi: MEH-ə qədər 1%, MEH-dən yuxarı hissənin 0.5%
                 // İşəgötürən: MEH-ə qədər 1%, MEH-dən yuxarı hissənin 0.5%
                 // (Sadələşdirmə: Bəzi mənbələrdə fərqli faizlər və ya limitlər ola bilər. 2025 qaydalarını dəqiqləşdirin)
                 const itsBaseLimit = 8000; // Təxmini limit (DƏQİQLƏŞDİRİLMƏLİDİR!)
                 let employeeITS = 0;
                 let employerITS = 0;
                 if(grossSalary <= itsBaseLimit) {
                     employeeITS = grossSalary * 0.02; // 2% of gross below limit
                     employerITS = grossSalary * 0.02; // 2% of gross below limit
                 } else {
                      employeeITS = (itsBaseLimit * 0.02) + ((grossSalary - itsBaseLimit) * 0.005); // 2% up to limit, 0.5% above
                      employerITS = (itsBaseLimit * 0.02) + ((grossSalary - itsBaseLimit) * 0.005); // 2% up to limit, 0.5% above
                 }


                // Gəlir Vergisi (GV) - Proqressivdir (Sadələşdirilmiş - Ailə vəziyyəti nəzərə alınmır)
                 let incomeTax = 0;
                 let taxableIncome = grossSalary - employeeDSMF - employeeITS; // DSMF və İTS çıxılır
                 const nonTaxableMinimum = 200; // 2025 üçün təxmini (DƏQİQLƏŞDİRİLMƏLİDİR!)

                 if (taxableIncome > nonTaxableMinimum) {
                    // Bu hesablama çox sadədir, real GV daha mürəkkəbdir.
                    // Məsələn: 2500 AZN-ə qədər 14%, 2500-dən yuxarı məbləğ üçün 25%
                    const taxLimit = 2500;
                     if (taxableIncome <= taxLimit) {
                         incomeTax = (taxableIncome - nonTaxableMinimum) * 0.14;
                     } else {
                         incomeTax = ((taxLimit - nonTaxableMinimum) * 0.14) + ((taxableIncome - taxLimit) * 0.25);
                     }
                 }
                 incomeTax = Math.max(0, incomeTax); // Vergi mənfi ola bilməz

                const totalDeductions = employeeDSMF + employeeITS + incomeTax;
                const netSalary = grossSalary - totalDeductions;
                const totalCost = grossSalary + employerDSMF + employerITS; // İşəgötürənin ümumi xərci

                return {
                    employeeDSMF: employeeDSMF.toFixed(2),
                    employerDSMF: (employerDSMF + employerITS).toFixed(2), // İTS daxil
                    incomeTax: incomeTax.toFixed(2),
                    netSalary: netSalary.toFixed(2),
                    totalCost: totalCost.toFixed(2),
                };
            };

             // --- Salary Input Preview ---
             salaryInput.addEventListener('input', () => {
                 const salary = parseFloat(salaryInput.value) || 0;
                 if (salary > 0) {
                     const calculations = calculateDSMF(salary);
                     dsmfPreview.innerHTML = `
                         İşçi DSMF: ~${calculations.employeeDSMF} ₼ |
                         İşəgötürən DSMF+İTS: ~${calculations.employerDSMF} ₼ |
                         GV: ~${calculations.incomeTax} ₼ |
                         Xalis Maaş: ~<strong style="color: var(--success-color);">${calculations.netSalary} ₼</strong> |
                         Ümumi Xərc: ~${calculations.totalCost} ₼
                         <br><small>(Hesablamalar təxminidir, GV ailə vəziyyətini nəzərə almır)</small>
                     `;
                 } else {
                     dsmfPreview.textContent = '';
                 }
             });


            // --- Render Employee List ---
            const renderEmployees = () => {
                employeeListBody.innerHTML = ''; // Clear existing list
                if (employees.length === 0) {
                    employeeListBody.innerHTML = '<tr><td colspan="10" style="text-align:center;">Heç bir işçi tapılmadı.</td></tr>';
                    return;
                }

                employees.forEach(emp => {
                    const calculations = calculateDSMF(emp.salary);
                    const row = document.createElement('tr');
                    row.setAttribute('data-id', emp.id);
                    row.innerHTML = `
                        <td>${emp.name}</td>
                        <td>${emp.position}</td>
                        <td>${formatDate(emp.hireDate)}</td>
                        <td class="currency">${parseFloat(emp.salary).toFixed(2)}</td>
                        <td class="currency">${calculations.employeeDSMF}</td>
                        <td class="currency">${calculations.employerDSMF}</td>
                        <td class="currency"><strong>${calculations.netSalary}</strong></td>
                        <td class="currency">${calculations.totalCost}</td>
                        <td>
                            <div class="vacation-controls">
                                <button class="btn-vacation btn-decrease-vacation" data-id="${emp.id}" aria-label="Məzuniyyət gününü azalt">-</button>
                                <span class="vacation-days">${emp.vacationDays}</span>
                                <button class="btn-vacation btn-increase-vacation" data-id="${emp.id}" aria-label="Məzuniyyət gününü artır">+</button>
                            </div>
                        </td>
                        <td class="actions">
                            <button class="btn-contract" data-id="${emp.id}">Müqavilə (PDF)</button>
                            <button class="btn-terminate" data-id="${emp.id}">İşdən Çıxart</button>
                        </td>
                    `;
                    employeeListBody.appendChild(row);
                });
            };

            // --- Format Date (Helper) ---
            const formatDate = (dateString) => {
                if (!dateString) return 'N/A';
                const date = new Date(dateString);
                const day = String(date.getDate()).padStart(2, '0');
                const month = String(date.getMonth() + 1).padStart(2, '0');
                const year = date.getFullYear();
                return `${day}.${month}.${year}`;
            };
             // --- Format Date for Contract (Helper) ---
            const formatContractDate = (dateString) => {
                 if (!dateString) return { day: '...', month: '...', year: '...' };
                 const date = new Date(dateString);
                 const day = String(date.getDate()).padStart(2, '0');
                 const months = ["Yanvar", "Fevral", "Mart", "Aprel", "May", "İyun", "İyul", "Avqust", "Sentyabr", "Oktyabr", "Noyabr", "Dekabr"];
                 const month = months[date.getMonth()];
                 const year = date.getFullYear();
                 return { day, month, year };
            }

            // --- Add Employee ---
            employeeForm.addEventListener('submit', (e) => {
                e.preventDefault();

                const name = document.getElementById('name').value.trim();
                const position = document.getElementById('position').value.trim();
                const salary = document.getElementById('salary').value;
                const hireDate = document.getElementById('hire-date').value;
                const vacationDays = parseInt(document.getElementById('vacation-days').value) || 0;
                const contractDuration = document.getElementById('contract-duration').value;


                if (!name || !position || !salary || !hireDate) {
                    alert('Zəhmət olmasa bütün vacib xanaları doldurun.');
                    return;
                }

                const newEmployee = {
                    id: Date.now().toString(), // Simple unique ID
                    name,
                    position,
                    salary: parseFloat(salary),
                    hireDate,
                    vacationDays,
                    contractDuration,
                    isActive: true // Default status
                };

                employees.push(newEmployee);
                saveAndRender();
                employeeForm.reset(); // Clear form
                dsmfPreview.textContent = ''; // Clear preview
                 // Scroll to the list after adding
                 document.getElementById('employee-list-section').scrollIntoView({ behavior: 'smooth' });
            });

            // --- Event Delegation for Buttons (Terminate, Contract, Vacation) ---
            employeeListBody.addEventListener('click', (e) => {
                const target = e.target;
                const id = target.getAttribute('data-id');

                if (!id) return; // Exit if no id found

                // Terminate Button
                if (target.classList.contains('btn-terminate')) {
                    if (confirm(`"${employees.find(emp => emp.id === id)?.name}" adlı işçini sistemdən silmək istədiyinizə əminsiniz?`)) {
                        employees = employees.filter(emp => emp.id !== id);
                        saveAndRender();
                    }
                }

                // Contract Button
                if (target.classList.contains('btn-contract')) {
                     generateContractPDF(id);
                }

                 // Increase Vacation Button
                 if (target.classList.contains('btn-increase-vacation')) {
                     updateVacationDays(id, 1);
                 }

                 // Decrease Vacation Button
                 if (target.classList.contains('btn-decrease-vacation')) {
                     updateVacationDays(id, -1);
                 }
            });

             // --- Update Vacation Days ---
             const updateVacationDays = (id, change) => {
                 const employee = employees.find(emp => emp.id === id);
                 if (employee) {
                     employee.vacationDays = Math.max(0, (employee.vacationDays || 0) + change); // Ensure days don't go below 0
                     saveAndRender();
                 }
             };

            // --- Generate Contract PDF ---
            const generateContractPDF = (id) => {
                const employee = employees.find(emp => emp.id === id);
                if (!employee) return;

                // Populate template (Replace placeholders - add more data fields as needed)
                 const placeholders = contractTemplate.querySelectorAll('.placeholder');
                 const contractDate = formatContractDate(new Date().toISOString()); // Use current date for contract

                 placeholders.forEach(span => {
                    const field = span.getAttribute('data-field');
                    let value = '...'; // Default placeholder text
                    switch (field) {
                        case 'contractNumber': value = `EMP-${employee.id.slice(-5)}`; break; // Simple contract number
                        case 'contractDateDay': value = contractDate.day; break;
                        case 'contractDateMonth': value = contractDate.month; break;
                        case 'contractDateYear': value = contractDate.year; break;
                        case 'companyName': value = '[Şirkətinizin Adı]'; break; // Replace with actual company name
                        case 'directorName': value = '[Direktorun A.S.]'; break; // Replace
                        case 'employeeName': value = employee.name; break;
                        case 'employeePassport': value = '[İşçinin ŞV №]'; break; // Add input for this?
                        case 'employeeIssueDate': value = '[ŞV Verilmə Tarixi]'; break; // Add input?
                        case 'employeeIssueAuthority': value = '[ŞV Verən Orqan]'; break; // Add input?
                        case 'employeeAddress': value = '[İşçinin Ünvanı]'; break; // Add input?
                        case 'employeePosition': value = employee.position; break;
                        case 'workLocation': value = '[Şirkətin Ünvanı]'; break; // Replace
                        case 'hireDate': value = formatDate(employee.hireDate); break;
                        case 'contractDuration': value = employee.contractDuration; break;
                        case 'grossSalary': value = `${parseFloat(employee.salary).toFixed(2)} ₼`; break;
                        case 'vacationDays': value = employee.vacationDays; break;
                         default: value = `[${field}]`; // Default if field not found
                     }
                     span.textContent = value;
                 });


                // Options for html2pdf
                const pdfOptions = {
                    margin: [15, 10, 15, 10], // top, left, bottom, right (in mm)
                    filename: `emek_muqavilesi_${employee.name.replace(/\s+/g, '_')}_${employee.id}.pdf`,
                    image: { type: 'jpeg', quality: 0.98 },
                    html2canvas: { scale: 2, useCORS: true }, // Improve quality, handle external images if any
                    jsPDF: { unit: 'mm', format: 'a4', orientation: 'portrait' }
                };

                 // Generate PDF
                 html2pdf().from(contractTemplate).set(pdfOptions).save()
                    .then(() => {
                        console.log('PDF yaradıldı və endirildi.');
                        // Optional: Reset template placeholders if needed after generation
                         // placeholders.forEach(span => span.textContent = `[${span.getAttribute('data-field')}]`);
                    }).catch(err => {
                         console.error("PDF yaratma xətası:", err);
                         alert("PDF yaradılarkən xəta baş verdi. Konsola baxın.");
                    });
            };


            // --- Save to Local Storage and Re-render ---
            const saveAndRender = () => {
                localStorage.setItem('employees', JSON.stringify(employees));
                renderEmployees();
            };

            // --- Initial Render ---
            renderEmployees();
        });
    </script>

</body>
</html>
