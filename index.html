 
<!DOCTYPE html>
<html lang="az">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Firebase HR İdarəetmə Sistemi</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js" integrity="sha512-GsLlZN/3F2ErC5ifS5QtgpiJtWd43JWSuIgh7mbzZ8zBps+dvLusV+eNQATqgA/HdeKFVgA5v3S/cIrLF7QnIg==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css" integrity="sha512-SnH5WK+bZxgPHs44uWIX+LLJAJ9/2PkPKZ5QiAj6Ta86w+fsb2TkcmfRyVX3pBnMFcV7oQPJkl9QevSCWr3W6A==" crossorigin="anonymous" referrerpolicy="no-referrer" />
    <style>
        /* --- CSS Variables --- */
        :root {
            --primary-color: #1e88e5;
            --primary-dark: #1565c0;
            --primary-light: #e3f2fd;
            --secondary-color: #f5f7fa;
            --accent-color: #78909c;
            --text-color: #263238;
            --text-muted: #607d8b;
            --border-color: #e0e0e0;
            --danger-color: #e53935;
            --success-color: #2e7d32;
            --warning-color: #ffb300;
            --info-color: #26c6da;
            --white-color: #ffffff;
            --dark-color: #212121;
            --font-family: 'Roboto', -apple-system, BlinkMacSystemFont, sans-serif;
            --border-radius: 8px;
            --box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
            --box-shadow-sm: 0 2px 4px rgba(0, 0, 0, 0.05);
            --transition: all 0.3s ease;
        }

        /* --- Global Styles --- */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        body {
            font-family: var(--font-family);
            background-color: var(--secondary-color);
            color: var(--text-color);
            line-height: 1.6;
            font-size: 16px;
            min-height: 100vh;
        }
        a, button {
            transition: var(--transition);
        }

        /* --- Loading Indicator --- */
        #loading-indicator {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(255, 255, 255, 0.8);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 10000;
            display: none;
        }
        #loading-indicator.active {
            display: flex;
        }
        #loading-indicator i {
            font-size: 2.5rem;
            color: var(--primary-color);
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            100% { transform: rotate(360deg); }
        }

        /* --- Auth Container --- */
        #auth-container {
            max-width: 480px;
            margin: 60px auto;
            padding: 32px;
            background: var(--white-color);
            border-radius: var(--border-radius);
            box-shadow: var(--box-shadow);
            animation: slideUp 0.5s ease-out;
        }
        #auth-container h2 {
            text-align: center;
            color: var(--primary-color);
            margin-bottom: 24px;
            font-size: 1.8rem;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }
        #auth-container .form-group {
            margin-bottom: 20px;
        }
        #auth-container label {
            font-weight: 500;
            color: var(--text-muted);
            margin-bottom: 6px;
            display: block;
        }
        #auth-container input {
            width: 100%;
            padding: 12px;
            border: 1px solid var(--border-color);
            border-radius: var(--border-radius);
            font-size: 1rem;
            transition: var(--transition);
        }
        #auth-container input:focus {
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px var(--primary-light);
            outline: none;
        }
        #auth-container button[type="submit"] {
            width: 100%;
            padding: 12px;
            font-size: 1.1rem;
            border-radius: var(--border-radius);
            border: none;
            cursor: pointer;
            transition: var(--transition);
        }
        #auth-container .btn-primary {
            background: var(--primary-color);
            color: var(--white-color);
        }
        #auth-container .btn-primary:hover {
            background: var(--primary-dark);
        }
        #auth-container .btn-success {
            background: var(--success-color);
            color: var(--white-color);
        }
        #auth-container .btn-success:hover {
            background: #1b5e20;
        }
        #auth-container .toggle-auth {
            text-align: center;
            margin-top: 20px;
            font-size: 0.9rem;
            color: var(--text-muted);
        }
        #auth-container .toggle-auth button {
            background: none;
            border: none;
            color: var(--primary-color);
            cursor: pointer;
            font-weight: 500;
            text-decoration: none;
        }
        #auth-container .toggle-auth button:hover {
            text-decoration: underline;
        }
        #auth-container .error-message {
            color: var(--danger-color);
            background: #ffebee;
            border: 1px solid var(--danger-color);
            padding: 12px;
            border-radius: var(--border-radius);
            margin-bottom: 16px;
            font-size: 0.9rem;
            text-align: center;
            display: none;
        }
        @keyframes slideUp {
            from { transform: translateY(20px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }

        /* --- Main App Container --- */
        #main-app-container {
            display: none;
            padding: 20px;
        }
        .main-container {
            max-width: 1440px;
            margin: 0 auto;
            background: var(--white-color);
            border-radius: var(--border-radius);
            box-shadow: var(--box-shadow);
            overflow: hidden;
        }
        header {
            background: linear-gradient(135deg, var(--primary-color), var(--primary-dark));
            color: var(--white-color);
            padding: 16px 32px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        header h1 {
            font-size: 1.6rem;
            font-weight: 500;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        .header-user-info {
            display: flex;
            align-items: center;
            gap: 16px;
            font-size: 0.95rem;
        }
        .header-user-info span {
            opacity: 0.9;
        }
        #logout-btn {
            background: var(--danger-color);
            color: var(--white-color);
            border: none;
            padding: 8px 16px;
            border-radius: var(--border-radius);
            cursor: pointer;
            font-size: 0.9rem;
            display: flex;
            align-items: center;
            gap: 6px;
        }
        #logout-btn:hover {
            background: #d32f2f;
        }

        /* --- Content Area --- */
        .content-area {
            padding: 32px;
        }
        h2, h3 {
            color: var(--text-color);
            margin-bottom: 24px;
            font-weight: 500;
        }
        h2 {
            font-size: 1.8rem;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        h3 {
            font-size: 1.3rem;
        }
        .tabs {
            display: flex;
            border-bottom: 1px solid var(--border-color);
            margin-bottom: 32px;
        }
        .tab-button {
            padding: 12px 24px;
            cursor: pointer;
            border: none;
            background: transparent;
            font-size: 1rem;
            font-weight: 500;
            color: var(--text-muted);
            border-bottom: 3px solid transparent;
            transition: var(--transition);
            display: flex;
            align-items: center;
            gap: 8px;
        }
        .tab-button.active {
            color: var(--primary-color);
            border-bottom-color: var(--primary-color);
        }
        .tab-button:hover {
            color: var(--primary-color);
            background: var(--primary-light);
        }
        .tab-content {
            display: none;
            animation: fadeIn 0.5s ease;
        }
        .tab-content.active {
            display: block;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* --- Form Styl
        .form-section {
            padding: 24px;
            background: var(--white-color);
            border: 1px solid var(--border-color);
            border-radius: var(--border-radius);
            margin-bottom: 32px;
            box-shadow: var(--box-shadow-sm);
        }
        .form-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 24px;
        }
        .form-group {
            display: flex;
            flex-direction: column;
        }
        .form-group label {
            margin-bottom: 8px;
            font-weight: 500;
            font-size: 0.95rem;
            color: var(--text-muted);
        }
        .form-group input, .form-group select, .form-group textarea {
            padding: 12px;
            border: 1px solid var(--border-color);
            border-radius: var(--border-radius);
            font-size: 1rem;
            transition: var(--transition);
        }
        .form-group input:focus, .form-group select:focus, .form-group textarea:focus {
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px var(--primary-light);
            outline: none;
        }
        .form-group textarea {
            resize: vertical;
            min-height: 100px;
        }
        .form-group input[type="number"]::-webkit-outer-spin-button,
        .form-group input[type="number"]::-webkit-inner-spin-button {
            -webkit-appearance: none;
            margin: 0;
        }
        .form-group input[type="number"] {
            -moz-appearance: textfield;
        }
        .form-actions {
            margin-top: 24px;
            padding-top: 16px;
            border-top: 1px solid var(--border-color);
            display: flex;
            justify-content: flex-end;
            gap: 12px;
        }
        .btn {
            padding: 10px 20px;
            font-size: 1rem;
            border-radius: var(--border-radius);
            cursor: pointer;
            border: none;
            transition: var(--transition);
            display: inline-flex;
            align-items: center;
            gap: 8px;
            font-weight: 500;
        }
        .btn i {
            font-size: 1.1em;
        }
        .btn-primary {
            background: var(--primary-color);
            color: var(--white-color);
        }
        .btn-primary:hover {
            background: var(--primary-dark);
        }
        .btn-secondary {
            background: var(--accent-color);
            color: var(--white-color);
        }
        .btn-secondary:hover {
            background: #546e7a;
        }
        .btn-success {
            background: var(--success-color);
            color: var(--white-color);
        }
        .btn-success:hover {
            background: #1b5e20;
        }
        .btn-danger {
            background: var(--danger-color);
            color: var(--white-color);
        }
        .btn-danger:hover {
            background: #d32f2f;
        }
        .btn-warning {
            background: var(--warning-color);
            color: var(--dark-color);
        }
        .btn-warning:hover {
            background: #ffa000;
        }
        .btn-info {
            background: var(--info-color);
            color: var(--dark-color);
        }
        .btn-info:hover {
            background: #00acc1;
        }
        .btn-sm {
            padding: 8px 16px;
            font-size: 0.9rem;
            gap: 6px;
        }
        .btn-sm i {
            font-size: 1em;
        }
        button:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }

        /* --- Employee Table --- */
        .table-container {
            overflow-x: auto;
            margin-top: 24px;
            border-radius: var(--border-radius);
            box-shadow: var(--box-shadow-sm);
        }
        .employee-table {
            width: 100%;
            border-collapse: collapse;
            background: var(--white-color);
        }
        .employee-table th, .employee-table td {
            border: 1px solid var(--border-color);
            padding: 12px 16px;
            text-align: left;
            font-size: 0.95rem;
        }
        .employee-table th {
            background: var(--primary-light);
            color: var(--primary-dark);
            font-weight: 600;
            position: sticky;
            top: 0;
            z-index: 10;
        }
        .employee-table tbody tr {
            transition: background 0.2s ease;
        }
        .employee-table tbody tr:nth-child(even) {
            background: #fafafa;
        }
        .employee-table tbody tr:hover {
            background: var(--primary-light);
        }
        .employee-table tbody tr td:first-child strong {
            cursor: pointer;
            color: var(--primary-color);
            font-weight: 500;
        }
        .employee-table tbody tr td:first-child strong:hover {
            text-decoration: underline;
        }
        .employee-table .actions {
            display: flex;
            gap: 8px;
            justify-content: center;
        }
        .currency::after {
            content: " ₼";
            font-size: 0.9em;
            color: var(--text-muted);
        }
        .status-active {
            color: var(--success-color);
            font-weight: 500;
        }
        .status-inactive {
            color: var(--danger-color);
            font-weight: 500;
        }
        .status-on_leave {
            color: var(--warning-color);
            font-weight: 500;
        }

        /* --- Modal --- */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            z-index: 1000;
            animation: fadeIn 0.3s ease;
        }
        .modal-dialog {
            max-width: 900px;
            margin: 40px auto;
            position: relative;
        }
        .modal-content {
            background: var(--white-color);
            border-radius: var(--border-radius);
            box-shadow: var(--box-shadow);
            overflow: hidden;
        }
        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 16px 24px;
            border-bottom: 1px solid var(--border-color);
            background: var(--primary-light);
        }
        .modal-title {
            font-size: 1.4rem;
            font-weight: 500;
            color: var(--primary-dark);
        }
        .btn-close {
            background: none;
            border: none;
            font-size: 1.2rem;
            color: var(--text-muted);
            cursor: pointer;
            padding: 8px;
        }
        .btn-close:hover {
            color: var(--text-color);
        }
        .modal-body {
            padding: 24px;
            max-height: 70vh;
            overflow-y: auto;
        }
        .modal-footer {
            padding: 16px 24px;
            border-top: 1px solid var(--border-color);
            display: flex;
            justify-content: flex-end;
            gap: 12px;
        }
        .detail-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
            gap: 16px;
            margin-bottom: 24px;
        }
        .detail-item strong {
            display: block;
            font-size: 0.9rem;
            color: var(--text-muted);
            margin-bottom: 4px;
        }
        .detail-item span {
            font-size: 1rem;
            word-break: break-word;
        }

        /* --- Contract Template --- */
        #contract-template {
            font-family: 'Times New Roman', Times, serif;
            padding: 30mm 20mm;
            background: var(--white-color);
            color: var(--dark-color);
            line-height: 1.8;
            font-size: 12pt;
            position: absolute;
            left: -9999px;
            width: 210mm;
            min-height: 297mm;
        }
        #contract-template h3 {
            text-align: center;
            font-size: 14pt;
            margin-bottom: 24px;
            font-weight: bold;
        }
        #contract-template h4 {
            font-size: 12pt;
            margin: 20px 0 12px;
            font-weight: bold;
        }
        #contract-template p, #contract-template li {
            margin-bottom: 12px;
            text-align: justify;
        }
        #contract-template ul {
            padding-left: 20px;
        }
        #contract-template .placeholder {
            border-bottom: 1px dotted #666;
            padding: 0 4px;
            min-width: 60px;
            display: inline-block;
        }
        #contract-template .indent {
            padding-left: 30px;
        }
        #contract-template .signatures {
            margin-top: 60px;
            display: flex;
            justify-content: space-between;
            gap: 20px;
        }
        #contract-template .signature-block {
            width: 48%;
        }
        #contract-template .signature-line {
            border-bottom: 1px solid var(--dark-color);
            margin: 24px 0 8px;
        }
        #contract-template .signature-title {
            font-size: 10pt;
            text-align: center;
        }

        /* --- Warning Box --- */
        .warning-box {
            background: #fff8e1;
            color: #5c4033;
            padding: 16px 24px;
            border: 1px solid #ffe082;
            border-radius: var(--border-radius);
            margin-bottom: 24px;
            font-size: 0.95rem;
        }
        .warning-box strong {
            font-weight: 600;
        }
        .calculation-preview {
            font-size: 0.9rem;
            color: var(--text-muted);
            background: #fafafa;
            padding: 12px;
            border-radius: var(--border-radius);
            border: 1px solid var(--border-color);
            margin-top: 8px;
            line-height: 1.5;
        }
        .calculation-preview strong {
            color: var(--success-color);
        }
        .calculation-preview .tax-details {
            font-size: 0.85rem;
            margin-top: 8px;
        }
        .calculation-preview .toggle-details {
            color: var(--primary-color);
            cursor: pointer;
            font-size: 0.9rem;
        }
        .calculation-preview .toggle-details:hover {
            text-decoration: underline;
        }

        /* --- Responsive Design --- */
        @media (max-width: 1200px) {
            .main-container {
                margin: 16px;
            }
            .form-grid {
                grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            }
        }
        @media (max-width: 992px) {
            .content-area {
                padding: 24px;
            }
            .modal-dialog {
                max-width: 80%;
            }
        }
        @media (max-width: 768px) {
            header {
                flex-direction: column;
                align-items: flex-start;
                gap: 12px;
            }
            .tabs {
                flex-wrap: wrap;
            }
            .tab-button {
                flex: 1;
                text-align: center;
                padding: 10px;
                font-size: 0.95rem;
            }
            .employee-table th, .employee-table td {
                padding: 10px;
                font-size: 0.9rem;
            }
            .employee-table .actions {
                flex-direction: column;
                gap: 6px;
            }
            .modal-dialog {
                max-width: 90%;
                margin: 20px auto;
            }
            .modal-body {
                padding: 16px;
            }
            .detail-grid {
                grid-template-columns: 1fr;
            }
            #auth-container {
                margin: 20px;
                padding: 24px;
            }
        }
        @media (max-width: 576px) {
            body {
                font-size: 0.95rem;
            }
            h2 {
                font-size: 1.5rem;
            }
            h3 {
                font-size: 1.2rem;
            }
            .form-grid {
                grid-template-columns: 1fr;
            }
            .btn {
                padding: 8px 16px;
                font-size: 0.9rem;
            }
            #auth-container {
                padding: 16px;
            }
            .warning-box {
                font-size: 0.9rem;
                padding: 12px 16px;
            }
        }
    </style>
</head>
<body>
    <div id="loading-indicator">
        <i class="fas fa-spinner"></i>
    </div>

    <div id="auth-container">
        <form id="login-form">
            <h2><i class="fas fa-sign-in-alt"></i> Giriş</h2>
            <div id="login-error" class="error-message"></div>
            <div class="form-group">
                <label for="login-email">Email:</label>
                <input type="email" id="login-email" required>
            </div>
            <div class="form-group">
                <label for="login-password">Şifrə:</label>
                <input type="password" id="login-password" required>
            </div>
            <button type="submit" class="btn btn-primary"><i class="fas fa-sign-in-alt"></i> Daxil Ol</button>
            <div class="toggle-auth">
                Hesabınız yoxdur? <button type="button" id="show-register">Qeydiyyatdan Keçin</button>
            </div>
        </form>

        <form id="register-form" style="display: none;">
            <h2><i class="fas fa-user-plus"></i> Qeydiyyat</h2>
            <div id="register-error" class="error-message"></div>
            <div class="form-group">
                <label for="register-email">Email:</label>
                <input type="email" id="register-email" required>
            </div>
            <div class="form-group">
                <label for="register-password">Şifrə (min. 6 simvol):</label>
                <input type="password" id="register-password" required minlength="6">
            </div>
            <div class="form-group">
                <label for="register-confirm-password">Şifrə Təkrarı:</label>
                <input type="password" id="register-confirm-password" required>
            </div>
            <button type="submit" class="btn btn-success"><i class="fas fa-user-plus"></i> Qeydiyyatdan Keç</button>
            <div class="toggle-auth">
                Artıq hesabınız var? <button type="button" id="show-login">Giriş Edin</button>
            </div>
        </form>
    </div>

    <div id="main-app-container">
        <div class="main-container">
            <header>
                <h1><i class="fas fa-briefcase"></i> HR Sistemi</h1>
                <div class="header-user-info">
                    <span id="user-email-display"></span>
                    <button id="logout-btn"><i class="fas fa-sign-out-alt"></i> Çıxış</button>
                </div>
            </header>
            <div class="content-area">
                <div class="warning-box">
                    <strong><i class="fas fa-exclamation-triangle"></i> Vacib Xəbərdarlıq:</strong> Bu sistem yalnız <strong>prototipdir</strong>. Bütün məlumatlar Firebase-də saxlanılır, lakin təhlükəsizlik qaydaları konfiqurasiya edilməyib. Real HR məlumatları üçün istifadə etməzdən əvvəl mütləq qaydaları tətbiq edin! ƏMAS sistemini əvəz etmir. DSMF/GV hesablamaları <strong>5 May 2025</strong> tarixinə olan təxminlərə əsaslanır və rəsmi qaydalarla dəqiqləşdirilməlidir. Yaradılan PDF müqavilələr rəsmi sənəd deyil.
                </div>

                <div class="tabs">
                    <button class="tab-button active" onclick="openTab(event, 'employee-management')"><i class="fas fa-users"></i> İşçilərin İdarə Edilməsi</button>
                    <button class="tab-button" onclick="openTab(event, 'company-settings')"><i class="fas fa-cog"></i> Şirkət Məlumatları</button>
                </div>

                <div id="employee-management" class="tab-content active">
                    <div id="add-edit-employee-section">
                        <h2 id="form-title"><i class="fas fa-user-plus"></i> Yeni İşçi Əlavə Et</h2>
                        <form id="employee-form" class="form-section">
                            <input type="hidden" id="employee-id">
                            <h3><i class="fas fa-id-card"></i> Şəxsi Məlumatlar</h3>
                            <div class="form-grid">
                                <div class="form-group">
                                    <label for="name">Ad, Soyad, Ata adı:</label>
                                    <input type="text" id="name" required>
                                </div>
                                <div class="form-group">
                                    <label for="fin-code">FIN Kod:</label>
                                    <input type="text" id="fin-code" maxlength="7" pattern="[A-Z0-9]{7}" title="7 rəqəm və/və ya böyük hərfdən ibarət olmalıdır" required>
                                </div>
                                <div class="form-group">
                                    <label for="gender">Cinsi:</label>
                                    <select id="gender" required>
                                        <option value="Kişi">Kişi</option>
                                        <option value="Qadın">Qadın</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label for="birth-date">Doğum Tarixi:</label>
                                    <input type="date" id="birth-date">
                                </div>
                                <div class="form-group">
                                    <label for="passport-series">Ş/V Seriya və Nömrə:</label>
                                    <input type="text" id="passport-series" placeholder="AZE12345678">
                                </div>
                                <div class="form-group">
                                    <label for="passport-issue-date">Ş/V Verilmə Tarixi:</label>
                                    <input type="date" id="passport-issue-date">
                                </div>
                                <div class="form-group">
                                    <label for="passport-authority">Ş/V Verən Orqan:</label>
                                    <input type="text" id="passport-authority" placeholder="ASAN Xidmət / Polis Şöbəsi">
                                </div>
                                <div class="form-group">
                                    <label for="citizenship">Vətəndaşlıq:</label>
                                    <input type="text" id="citizenship" value="Azərbaycan" required>
                                </div>
                            </div>
                            <h3><i class="fas fa-map-marker-alt"></i> Ünvan və Əlaqə</h3>
                            <div class="form-grid">
                                <div class="form-group">
                                    <label for="address-registration">Qeydiyyat Ünvanı:</label>
                                    <textarea id="address-registration"></textarea>
                                </div>
                                <div class="form-group">
                                    <label for="address-actual">Faktiki Yaşayış Ünvanı:</label>
                                    <textarea id="address-actual"></textarea>
                                </div>
                                <div class="form-group">
                                    <label for="phone">Mobil Telefon:</label>
                                    <input type="tel" id="phone" placeholder="+994 XX XXX XX XX" pattern="\+994\s?[0-9]{2}\s?[0-9]{3}\s?[0-9]{2}\s?[0-9]{2}">
                                </div>
                                <div class="form-group">
                                    <label for="email">Email Ünvanı:</label>
                                    <input type="email" id="email">
                                </div>
                            </div>
                            <h3><i class="fas fa-briefcase"></i> İş Məlumatları</h3>
                            <div class="form-grid">
                                <div class="form-group">
                                    <label for="position">Vəzifə:</label>
                                    <input type="text" id="position" required>
                                </div>
                                <div class="form-group">
                                    <label for="department">Struktur Bölməsi/Şöbə:</label>
                                    <input type="text" id="department">
                                </div>
                                <div class="form-group">
                                    <label for="hire-date">İşə Başlama Tarixi:</label>
                                    <input type="date" id="hire-date" required>
                                </div>
                                <div class="form-group">
                                    <label for="contract-type">Əmək Müqaviləsinin Növü:</label>
                                    <select id="contract-type" required>
                                        <option value="Müddətsiz">Müddətsiz</option>
                                        <option value="Müddətli">Müddətli</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label for="contract-duration">Müqavilə Müddəti (varsa):</label>
                                    <input type="text" id="contract-duration" placeholder="Məs: 1 il, 6 ay">
                                </div>
                                <div class="form-group">
                                    <label for="trial-period">Sınaq Müddəti (ay):</label>
                                    <input type="number" id="trial-period" min="0" max="6" value="0">
                                </div>
                                <div class="form-group">
                                    <label for="work-schedule">İş Rejimi:</label>
                                    <input type="text" id="work-schedule" value="5 günlük iş həftəsi, 09:00-18:00">
                                </div>
                                <div class="form-group">
                                    <label for="vacation-days">İllik Əsas Məzuniyyət Günləri:</label>
                                    <input type="number" id="vacation-days" min="0" value="21" required>
                                </div>
                            </div>
                            <h3><i class="fas fa-money-check-alt"></i> Əmək Haqqı və Bank</h3>
                            <div class="form-grid">
                                <div class="form-group">
                                    <label for="salary">Aylıq Brüt Əmək Haqqı (AZN):</label>
                                    <input type="number" id="salary" step="0.01" min="0" required>
                                    <div id="dsmf-calculation-preview" class="calculation-preview" style="display: none;"></div>
                                </div>
                                <div class="form-group">
                                    <label for="iban">Bank Hesabı (IBAN):</label>
                                    <input type="text" id="iban" placeholder="AZXX XXXX XXXX XXXX XXXX XXXX" pattern="AZ[0-9A-Z]{26}">
                                </div>
                            </div>
                            <h3><i class="fas fa-user-cog"></i> Digər Məlumatlar</h3>
                            <div class="form-grid">
                                <div class="form-group">
                                    <label for="education">Təhsil Səviyyəsi:</label>
                                    <select id="education">
                                        <option value="">Seçin...</option>
                                        <option value="Orta">Orta</option>
                                        <option value="Orta İxtisas">Orta İxtisas</option>
                                        <option value="Bakalavr">Bakalavr</option>
                                        <option value="Magistr">Magistr</option>
                                        <option value="Elmlər Namizədi/Fəlsəfə Doktoru">Elmlər Namizədi/Fəlsəfə Doktoru</option>
                                        <option value="Elmlər Doktoru">Elmlər Doktoru</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label for="marital-status">Ailə Vəziyyəti:</label>
                                    <select id="marital-status">
                                        <option value="">Seçin...</option>
                                        <option value="Subay">Subay</option>
                                        <option value="Evli">Evli</option>
                                        <option value="Boşanmış">Boşanmış</option>
                                        <option value="Dul">Dul</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label for="status">İşçinin Statusu:</label>
                                    <select id="status" required>
                                        <option value="active">Aktiv</option>
                                        <option value="terminated">İşdən Çıxarılıb</option>
                                        <option value="on_leave">Məzuniyyətdə</option>
                                    </select>
                                </div>
                            </div>
                            <div class="form-actions">
                                <button type="button" id="cancel-edit-btn" class="btn btn-secondary" style="display: none;"><i class="fas fa-times"></i> Ləğv Et</button>
                                <button type="submit" id="submit-btn" class="btn btn-primary"><i class="fas fa-save"></i> Yadda Saxla</button>
                            </div>
                        </form>
                    </div>
                    <div id="employee-list-section">
                        <h2><i class="fas fa-list-ul"></i> İşçilərin Siyahısı</h2>
                        <div class="table-container">
                            <table class="employee-table">
                                <thead>
                                    <tr>
                                        <th>Ad Soyad</th>
                                        <th>Vəzifə</th>
                                        <th>FIN Kod</th>
                                        <th>İşə Başlama</th>
                                        <th>Brüt Maaş</th>
                                        <th>Xalis Maaş (Təxmini)</th>
                                        <th>Status</th>
                                        <th>Əməliyyatlar</th>
                                    </tr>
                                </thead>
                                <tbody></tbody>
                            </table>
                        </div>
                    </div>
                </div>

                <div id="company-settings" class="tab-content">
                    <h2><i class="fas fa-cog"></i> Şirkət Məlumatları (Müqavilə üçün)</h2>
                    <form id="settings-form" class="form-section">
                        <div class="form-grid">
                            <div class="form-group">
                                <label for="company-name">Şirkətin Tam Adı:</label>
                                <input type="text" id="company-name" required>
                            </div>
                            <div class="form-group">
                                <label for="company-voen">VÖEN:</label>
                                <input type="text" id="company-voen" required>
                            </div>
                            <div class="form-group">
                                <label for="company-address">Hüquqi Ünvan:</label>
                                <input type="text" id="company-address" required>
                            </div>
                            <div class="form-group">
                                <label for="company-director">Direktorun Adı, Soyadı, Ata adı:</label>
                                <input type="text" id="company-director" required>
                            </div>
                            <div class="form-group">
                                <label for="company-represented-by">Nəyin əsasında təmsil olunur:</label>
                                <input type="text" id="company-represented-by" placeholder="Nizamnamə, Əsasnamə və s." value="Nizamnamə" required>
                            </div>
                        </div>
                        <div class="form-actions">
                            <button type="submit" class="btn btn-primary"><i class="fas fa-save"></i> Məlumatları Yadda Saxla</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <div id="employeeDetailModal" class="modal">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h3 class="modal-title" id="modal-employee-name">İşçi Məlumatları</h3>
                    <button type="button" class="btn-close" onclick="closeModal('employeeDetailModal')">&times;</button>
                </div>
                <div class="modal-body" id="modal-body-content">
                    <p>Yüklənir...</p>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" onclick="closeModal('employeeDetailModal')"><i class="fas fa-times"></i> Bağla</button>
                    <button type="button" id="modal-edit-btn" class="btn btn-warning"><i class="fas fa-edit"></i> Redaktə Et</button>
                    <button type="button" id="modal-contract-btn" class="btn btn-success"><i class="fas fa-file-pdf"></i> Müqavilə (PDF)</button>
                    <button type="button" id="modal-terminate-btn" class="btn btn-danger"><i class="fas fa-user-times"></i> İşdən Çıxart</button>
                </div>
            </div>
        </div>
    </div>

    <div id="contract-template" aria-hidden="true">
        <h3>ƏMƏK MÜQAVİLƏSİ № <span class="placeholder" data-field="contractNumber">EMP-00000</span></h3>
        <p style="display: flex; justify-content: space-between;">
            <span>Bakı şəhəri</span>
            <span>"<span class="placeholder" data-field="contractDateDay">DD</span>" <span class="placeholder" data-field="contractDateMonth">Ay</span> <span class="placeholder" data-field="contractDateYear">YYYY</span>-cı il</span>
        </p>
        <br/>
        <p>Bundan sonra “İşəgötürən” adlandırılacaq <strong class="placeholder" data-field="companyName">[Şirkətin Adı]</strong> (VÖEN: <span class="placeholder" data-field="companyVoen">[VÖEN]</span>, Hüquqi ünvan: <span class="placeholder" data-field="companyAddress">[Şirkətin Ünvanı]</span>), <span class="placeholder" data-field="companyRepresentedBy">[Nizamnamə]</span> əsasında fəaliyyət göstərən Direktor <strong class="placeholder" data-field="companyDirector">[Direktorun A.S.A.]</strong> şəxsində, bir tərəfdən, və bundan sonra “İşçi” adlandırılacaq <strong class="placeholder" data-field="employeeCitizenship">[Vətəndaşlıq]</strong> Respublikasının vətəndaşı <strong class="placeholder" data-field="employeeFullName">[İşçinin A.S.A.]</strong> (Doğum tarixi: <span class="placeholder" data-field="employeeBirthDate">[Doğum Tarixi]</span>, Cinsi: <span class="placeholder" data-field="employeeGender">[Cins]</span>, FIN kod: <span class="placeholder" data-field="employeeFinCode">[FIN]</span>, Ş/V: <span class="placeholder" data-field="employeePassportSeries">[Seriya Nömrə]</span>, <span class="placeholder" data-field="employeePassportIssueDate">[Verilmə Tarixi]</span> tarixində <span class="placeholder" data-field="employeePassportAuthority">[Verən Orqan]</span> tərəfindən verilmişdir, Qeydiyyat ünvanı: <span class="placeholder" data-field="employeeAddressRegistration">[Qeydiyyat Ünvanı]</span>, Faktiki ünvan: <span class="placeholder" data-field="employeeAddressActual">[Faktiki Ünvanı]</span>), digər tərəfdən (bundan sonra birgə “Tərəflər” adlandırılacaqlar), Azərbaycan Respublikasının Əmək Məcəlləsini rəhbər tutaraq, aşağıdakılar barədə razılığa gələrək bu Əmək Müqaviləsini (bundan sonra “Müqavilə”) bağladılar:</p>
        <h4>1. MÜQAVİLƏNİN ƏSAS ŞƏRTLƏRİ</h4>
        <p>1.1. Bu Müqaviləyə əsasən İşəgötürən İşçini <strong class="placeholder" data-field="employeePosition">[Vəzifə]</strong> vəzifəsinə, <span class="placeholder" data-field="employeeDepartment">[Struktur Bölməsi]</span> struktur bölməsində işə qəbul edir.</p>
        <p>1.2. İş yeri İşTITLE: İşəgötürənin <strong class="placeholder" data-field="companyAddress">[Şirkətin Ünvanı]</strong> ünvanında yerləşən əsas iş yeridir.</p>
        <p>1.3. İşçinin işə başlama tarixi: <strong class="placeholder" data-field="hireDate">[İşə Başlama Tarixi]</strong>.</p>
        <p>1.4. Bu Müqavilə <strong class="placeholder" data-field="contractDurationText">[Müddətli/Müddətsiz]</strong> bağlanılır.</p>
        <p class="indent" style="display: <span class="placeholder" data-field="contractTermDisplay">none</span>;">
            1.4.1. Müqavilənin müddəti: <strong class="placeholder" data-field="contractDurationValue">[Müddət]</strong>.
        </p>
        <p>1.5. İşçiyə <strong class="placeholder" data-field="trialPeriod">[Sınaq Müddəti]</strong> ay sınaq müddəti təyin edilir. Sınaq müddəti ərzində tərəflərdən hər biri digər tərəfi 3 gün əvvəl yazılı xəbərdar etməklə müqaviləyə xitam verə bilər.</p>
        <h4>2. ƏMƏK HAQQI VƏ ÖDƏNİŞLƏR</h4>
        <p>2.1. İşçiyə yerinə yetirdiyi əmək funksiyasına görə aylıq <strong class="placeholder" data-field="grossSalaryFormatted">[Maaş Rəqəmlə]</strong> (<span class="placeholder" data-field="grossSalaryText">[Maaş Yazı ilə]</span>) manat məbləğində vəzifə maaşı (brüt) müəyyən edilir.</p>
        <p>2.2. İşçinin əmək haqqından qanunvericiliklə müəyyən edilmiş qaydada gəlir vergisi, məcburi dövlət sosial sığorta (DSMF) haqqı, işsizlikdən sığorta haqqı və icbari tibbi sığorta (İTS) haqqı tutulur.</p>
        <p>2.3. İşəgötürən İşçinin əmək haqqından əlavə öz vəsaiti hesabına qanunvericiliklə müəyyən edilmiş məbləğdə və qaydada DSMF haqqı, işsizlikdən sığorta haqqı və İTS haqqı ödəyir.</p>
        <p>2.4. Əmək haqqı ayda iki dəfə (avanş və qalıq hissə) olmaqla İşçinin <strong class="placeholder" data-field="employeeIban">[IBAN Hesab Nömrəsi]</strong> nömrəli bank hesabına köçürülür.</p>
        <h4>3. İŞ VƏ İSTİRAHƏT VAXTI</h4>
        <p>3.1. İşçiyə <strong class="placeholder" data-field="workSchedule">[İş Rejimi Mətni]</strong> müəyyən edilir.</p>
        <p>3.2. İşçiyə hər iş ili üçün Azərbaycan Respublikasının Əmək Məcəlləsinə uyğun olaraq <strong class="placeholder" data-field="vacationDays">[Məzuniyyət Günü]</strong> təqvim günü müddətində ödənişli əsas əmək məzuniyyəti verilir. Əlavə məzuniyyətlər qanunvericiliklə müəyyən edilmiş hallarda və müddətdə verilir.</p>
        <h4>4. TƏRƏFLƏRİN HÜQUQ VƏ VƏZİFƏLƏRİ</h4>
        <p>4.1. <strong>İşçinin vəzifələri:</strong></p>
        <ul style="list-style-type: lower-alpha;">
            <li>Bu Müqavilə ilə müəyyən edilmiş əmək funksiyasını vicdanla yerinə yetirmək;</li>
            <li>Əmək intizamına, İşəgötürənin daxili intizam qaydalarına, əməyin mühafizəsi norma və qaydalarına riayət etmək;</li>
            <li>İşəgötürənin əmlakına qayğı ilə yanaşmaq, kommersiya sirrini və məxfi məlumatları qorumaq;</li>
            <li>Qanunvericiliklə və daxili sənədlərlə müəyyən edilmiş digər vəzifələri yerinə yetirmək.</li>
        </ul>
        <p>4.2. <strong>İşçinin hüquqları:</strong></p>
        <ul style="list-style-type: lower-alpha;">
            <li>Bu Müqavilədə və qanunvericilikdə nəzərdə tutulmuş əmək haqqını vaxtında və tam almaq;</li>
            <li>Normal əmək şəraiti ilə təmin olunmaq;</li>
            <li>Məzuniyyət hüququndan istifadə etmək;</li>
            <li>Peşə hazırlığını artırmaq;</li>
            <li>Qanunvericiliklə müəyyən edilmiş digər hüquqlardan istifadə etmək.</li>
        </ul>
        <p>4.3. <strong>İşəgötürənin vəzifələri:</strong></p>
        <ul style="list-style-type: lower-alpha;">
            <li>İşçini qanunvericiliyə uyğun əmək şəraiti ilə təmin etmək;</li>
            <li>Əmək haqqını vaxtında və tam ödəmək;</li>
            <li>İşçinin sosial sığortalanmasını təmin etmək;</li>
            <li>Əməyin mühafizəsi və təhlükəsizliyi qaydalarına riayət etmək;</li>
            <li>Qanunvericiliklə müəyyən edilmiş digər vəzifələri yerinə yetirmək.</li>
        </ul>
        <p>4.4. <strong>İşəgötürənin hüquqları:</strong></p>
        <ul style="list-style-type: lower-alpha;">
            <li>İşçidən əmək funksiyalarının vicdanla yerinə yetirilməsini tələb etmək;</li>
            <li>İşçini həvəsləndirmək və intizam tənbehi tədbirləri görmək;</li>
            <li>Qanunvericiliklə müəyyən edilmiş digər hüquqlardan istifadə etmək.</li>
        </ul>
        <h4>5. MÜQAVİLƏYƏ XİTAM VERİLMƏSİ</h4>
        <p>5.1. Bu Müqaviləyə Azərbaycan Respublikasının Əmək Məcəlləsində nəzərdə tutulmuş əsaslarla və qaydada xitam verilə bilər.</p>
        <h4>6. YEKUN MÜDDƏALAR</h4>
        <p>6.1. Bu Müqavilə Tərəflər arasında imzalandığı andan qüvvəyə minir.</p>
        <p>6.2. Bu Müqaviləyə bütün dəyişiklik və əlavələr yazılı şəkildə tərtib edilir və Tərəflərin səlahiyyətli nümayəndələri tərəfindən imzalanır.</p>
        <p>6.3. Bu Müqavilə ilə tənzimlənməyən məsələlər Azərbaycan Respublikasının qüvvədə olan qanunvericiliyi ilə tənzimlənir.</p>
        <p>6.4. Müqavilə eyni hüquqi qüvvəyə malik iki nüsxədə tərtib edilmişdir, bir nüsxə İşəgötürəndə, digər nüsxə İşçidə saxlanılır.</p>
        <h4>7. TƏRƏFLƏRİN ÜNVANLARI VƏ REKVİZİTLƏRİ</h4>
        <div class="signatures">
            <div class="signature-block">
                <strong>İŞƏGÖTÜRƏN:</strong><br/>
                <strong class="placeholder" data-field="companyName">[Şirkətin Adı]</strong><br/>
                Ünvan: <span class="placeholder" data-field="companyAddress">[Şirkətin Ünvanı]</span><br/>
                VÖEN: <span class="placeholder" data-field="companyVoen">[VÖEN]</span><br/>
                <br/>
                Direktor:<br/>
                <div class="signature-line"></div>
                <div class="signature-title">(İmza, Möhür) <span class="placeholder" data-field="companyDirector">[Direktor A.S.A.]</span></div>
            </div>
            <div class="signature-block">
                <strong>İŞÇİ:</strong><br/>
                <strong class="placeholder" data-field="employeeFullName">[İşçinin A.S.A.]</strong><br/>
                Ünvan: <span class="placeholder" data-field="employeeAddressRegistration">[Qeydiyyat Ünvanı]</span><br/>
                FIN: <span class="placeholder" data-field="employeeFinCode">[FIN]</span><br/>
                Ş/V: <span class="placeholder" data-field="employeePassportSeries">[Seriya Nömrə]</span><br/>
                <br/>
                İşçi:<br/>
                <div class="signature-line"></div>
                <div class="signature-title">(İmza) <span class="placeholder" data-field="employeeFullName">[İşçinin A.S.A.]</span></div>
            </div>
        </div>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.22.2/firebase-app.js";
        import {
            getAuth,
            createUserWithEmailAndPassword,
            signInWithEmailAndPassword,
            onAuthStateChanged,
            signOut
        } from "https://www.gstatic.com/firebasejs/9.22.2/firebase-auth.js";
        import {
            getFirestore,
            collection,
            doc,
            addDoc,
            setDoc,
            getDocs,
            deleteDoc,
            onSnapshot,
            query,
            orderBy
        } from "https://www.gstatic.com/firebasejs/9.22.2/firebase-firestore.js";

        // Firebase configuration
        const firebaseConfig = {
            apiKey: "AIzaSyCOvdvFHbwji_yhzPjAlGTtjlIJNLC2y_Q",
            authDomain: "hrteam-afad9.firebaseapp.com",
            databaseURL: "https://hrteam-afad9-default-rtdb.firebaseio.com",
            projectId: "hrteam-afad9",
            storageBucket: "hrteam-afad9.firebasestorage.app",
            messagingSenderId: "1066969486587",
            appId: "1:1066969486587:web:f557ca9c162ac7ae620c5e",
            measurementId: "G-THQZTV493J"
        };

        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);

        // Global variables
        let currentUser = null;
        let currentUserId = null;
        let employees = [];
        let companySettings = {};
        let editingEmployeeId = null;
        let unsubscribeSettings = null;
        let unsubscribeEmployees = null;

        // DOM elements
        const loadingIndicator = document.getElementById('loading-indicator');
        const authContainer = document.getElementById('auth-container');
        const mainAppContainer = document.getElementById('main-app-container');
        const loginForm = document.getElementById('login-form');
        const registerForm = document.getElementById('register-form');
        const loginError = document.getElementById('login-error');
        const registerError = document.getElementById('register-error');
        const showRegisterBtn = document.getElementById('show-register');
        const showLoginBtn = document.getElementById('show-login');
        const userEmailDisplay = document.getElementById('user-email-display');
        const logoutBtn = document.getElementById('logout-btn');
        const employeeForm = document.getElementById('employee-form');
        const employeeTableBody = document.querySelector('.employee-table tbody');
        const settingsForm = document.getElementById('settings-form');
        const salaryInput = document.getElementById('salary');
        const dsmfPreview = document.getElementById('dsmf-calculation-preview');
        const contractTemplate = document.getElementById('contract-template');
        const employeeDetailModal = document.getElementById('employeeDetailModal');
        const modalBodyContent = document.getElementById('modal-body-content');
        const modalEmployeeName = document.getElementById('modal-employee-name');
        const formTitle = document.getElementById('form-title');
        const submitBtn = document.getElementById('submit-btn');
        const cancelEditBtn = document.getElementById('cancel-edit-btn');
        const modalEditBtn = document.getElementById('modal-edit-btn');
        const modalContractBtn = document.getElementById('modal-contract-btn');
        const modalTerminateBtn = document.getElementById('modal-terminate-btn');

        // Loading state
        function showLoading(show) {
            loadingIndicator.classList.toggle('active', show);
        }

        // Authentication state listener
        showLoading(true);
        onAuthStateChanged(auth, (user) => {
            if (user) {
                currentUser = user;
                currentUserId = user.uid;
                userEmailDisplay.textContent = user.email;
                authContainer.style.display = 'none';
                mainAppContainer.style.display = 'block';

                // Clean up previous listeners
                if (unsubscribeSettings) unsubscribeSettings();
                if (unsubscribeEmployees) unsubscribeEmployees();

                // Fetch data
                fetchCompanySettings();
                fetchEmployees();
                resetForm();
                openTab(null, 'employee-management');
            } else {
                currentUser = null;
                currentUserId = null;
                userEmailDisplay.textContent = '';
                authContainer.style.display = 'block';
                mainAppContainer.style.display = 'none';
                employeeTableBody.innerHTML = '<tr><td colspan="8" style="text-align:center;">Giriş edin...</td></tr>';
                employees = [];
                companySettings = {};
                resetForm();

                if (unsubscribeSettings) unsubscribeSettings();
                if (unsubscribeEmployees) unsubscribeEmployees();
            }
            showLoading(false);
        });

        // Toggle auth forms
        showRegisterBtn.addEventListener('click', () => {
            loginForm.style.display = 'none';
            registerForm.style.display = 'block';
            loginError.style.display = 'none';
            registerError.style.display = 'none';
        });

        showLoginBtn.addEventListener('click', () => {
            loginForm.style.display = 'block';
            registerForm.style.display = 'none';
            loginError.style.display = 'none';
            registerError.style.display = 'none';
        });

        // Show error message
        function showError(element, message) {
            element.textContent = message;
            element.style.display = 'block';
            setTimeout(() => element.style.display = 'none', 5000);
        }

        // Register user
        registerForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            const email = document.getElementById('register-email').value.trim();
            const password = document.getElementById('register-password').value;
            const confirmPassword = document.getElementById('register-confirm-password').value;

            if (password !== confirmPassword) {
                showError(registerError, 'Şifrələr uyğun gəlmir!');
                return;
            }
            if (password.length < 6) {
                showError(registerError, 'Şifrə ən azı 6 simvol olmalıdır!');
                return;
            }

            showLoading(true);
            try {
                await createUserWithEmailAndPassword(auth, email, password);
                showSuccess('Qeydiyyat uğurla tamamlandı!');
            } catch (error) {
                showError(registerError, `Qeydiyyat xətası: ${error.message}`);
            } finally {
                showLoading(false);
            }
        });

        // Login user
        loginForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            const email = document.getElementById('login-email').value.trim();
            const password = document.getElementById('login-password').value;

            showLoading(true);
            try {
                await signInWithEmailAndPassword(auth, email, password);
                showSuccess('Giriş uğurla tamamlandı!');
            } catch (error) {
                showError(loginError, `Giriş xətası: ${error.message}`);
            } finally {
                showLoading(false);
            }
        });

        // Logout user
        logoutBtn.addEventListener('click', async () => {
            showLoading(true);
            try {
                await signOut(auth);
                showSuccess('Çıxış uğurla tamamlandı!');
            } catch (error) {
                showError(loginError, `Çıxış xətası: ${error.message}`);
            } finally {
                showLoading(false);
            }
        });

        // Fetch company settings
        function fetchCompanySettings() {
            if (!currentUserId) return;
            const settingsRef = doc(db, 'users', currentUserId);
            unsubscribeSettings = onSnapshot(settingsRef, (doc) => {
                if (doc.exists() && doc.data().companySettings) {
                    companySettings = doc.data().companySettings;
                    populateSettingsForm();
                } else {
                    companySettings = {
                        companyName: '',
                        companyVoen: '',
                        companyAddress: '',
                        companyDirector: '',
                        companyRepresentedBy: 'Nizamnamə'
                    };
                    populateSettingsForm();
                }
            }, (error) => {
                console.error('Settings fetch error:', error);
                showError(loginError, 'Şirkət məlumatlarını yükləyərkən xəta baş verdi.');
            });
        }

        // Fetch employees
        function fetchEmployees() {
            if (!currentUserId) return;
            const employeesRef = collection(db, 'users', currentUserId, 'employees');
            const q = query(employeesRef, orderBy('name', 'asc'));
            unsubscribeEmployees = onSnapshot(q, (snapshot) => {
                employees = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
                renderEmployeeTable();
                showLoading(false);
            }, (error) => {
                console.error('Employees fetch error:', error);
                employeeTableBody.innerHTML = '<tr><td colspan="8" style="text-align:center;color:var(--danger-color);">Məlumatlar yüklənə bilmədi.</td></tr>';
                showLoading(false);
            });
        }

        // Save company settings
        settingsForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            if (!currentUserId) {
                showError(loginError, 'Giriş edilməyib!');
                return;
            }

            const settings = {
                companyName: document.getElementById('company-name').value.trim(),
                companyVoen: document.getElementById('company-voen').value.trim(),
                companyAddress: document.getElementById('company-address').value.trim(),
                companyDirector: document.getElementById('company-director').value.trim(),
                companyRepresentedBy: document.getElementById('company-represented-by').value.trim()
            };

            showLoading(true);
            try {
                await setDoc(doc(db, 'users', currentUserId), { companySettings: settings }, { merge: true });
                companySettings = settings;
                showSuccess('Şirkət məlumatları yadda saxlanıldı.');
            } catch (error) {
                console.error('Settings save error:', error);
                showError(loginError, `Məlumat saxlanarkən xəta: ${error.message}`);
            } finally {
                showLoading(false);
            }
        });

        // Save employee
        employeeForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            if (!currentUserId) {
                showError(loginError, 'Giriş edilməyib!');
                return;
            }

            const employeeData = {
                name: document.getElementById('name').value.trim(),
                finCode: document.getElementById('fin-code').value.trim().toUpperCase(),
                gender: document.getElementById('gender').value,
                birthDate: document.getElementById('birth-date').value || null,
                passportSeries: document.getElementById('passport-series').value.trim(),
                passportIssueDate: document.getElementById('passport-issue-date').value || null,
                passportAuthority: document.getElementById('passport-authority').value.trim(),
                citizenship: document.getElementById('citizenship').value.trim(),
                addressRegistration: document.getElementById('address-registration').value.trim(),
                addressActual: document.getElementById('address-actual').value.trim(),
                phone: document.getElementById('phone').value.trim(),
                email: document.getElementById('email').value.trim(),
                position: document.getElementById('position').value.trim(),
                department: document.getElementById('department').value.trim(),
                hireDate: document.getElementById('hire-date').value || null,
                contractType: document.getElementById('contract-type').value,
                contractDuration: document.getElementById('contract-duration').value.trim(),
                trialPeriod: parseInt(document.getElementById('trial-period').value) || 0,
                workSchedule: document.getElementById('work-schedule').value.trim(),
                vacationDays: parseInt(document.getElementById('vacation-days').value) || 21,
                salary: parseFloat(document.getElementById('salary').value) || 0,
                iban: document.getElementById('iban').value.trim().toUpperCase().replace(/\s/g, ''),
                education: document.getElementById('education').value,
                maritalStatus: document.getElementById('marital-status').value,
                status: document.getElementById('status').value
            };

            // Validation
            if (!employeeData.name) {
                showError(loginError, 'Ad, Soyad, Ata adı daxil edilməlidir.');
                return;
            }
            if (!employeeData.finCode.match(/^[A-Z0-9]{7}$/)) {
                showError(loginError, 'FIN kod 7 simvoldan ibarət olmalıdır (rəqəm və ya böyük hərf).');
                return;
            }
            if (!employeeData.position) {
                showError(loginError, 'Vəzifə daxil edilməlidir.');
                return;
            }
            if (!employeeData.hireDate) {
                showError(loginError, 'İşə başlama tarixi daxil edilməlidir.');
                return;
            }
            if (employeeData.salary <= 0) {
                showError(loginError, 'Brüt maaş sıfırdan böyük olmalıdır.');
                return;
            }

            showLoading(true);
            try {
                if (editingEmployeeId) {
                    await setDoc(doc(db, 'users', currentUserId, 'employees', editingEmployeeId), employeeData, { merge: true });
                    showSuccess('İşçi məlumatları yeniləndi.');
                } else {
                    await addDoc(collection(db, 'users', currentUserId, 'employees'), employeeData);
                    showSuccess('Yeni işçi əlavə edildi.');
                }
                resetForm();
                document.getElementById('employee-list-section').scrollIntoView({ behavior: 'smooth' });
            } catch (error) {
                console.error('Employee save error:', error);
                showError(loginError, `İşçi məlumatları saxlanarkən xəta: ${error.message}`);
            } finally {
                showLoading(false);
            }
        });

        // Terminate employee
        async function terminateEmployee(id, closeModalAfter = false) {
            const employee = employees.find(emp => emp.id === id);
            if (!employee || !currentUserId) return;

            if (!confirm(`"${employee.name}" adlı işçinin statusunu "İşdən Çıxarılıb" olaraq dəyişmək istəyirsiniz?`)) return;

            showLoading(true);
            try {
                await setDoc(doc(db, 'users', currentUserId, 'employees', id), { status: 'terminated' }, { merge: true });
                showSuccess('İşçi statusu yeniləndi.');
                if (closeModalAfter) closeModal('employeeDetailModal');
            } catch (error) {
                console.error('Terminate error:', error);
                showError(loginError, `Status yenilənərkən xəta: ${error.message}`);
            } finally {
                showLoading(false);
            }
        }

        // Populate settings form
        function populateSettingsForm() {
            document.getElementById('company-name').value = companySettings.companyName || '';
            document.getElementById('company-voen').value = companySettings.companyVoen || '';
            document.getElementById('company-address').value = companySettings.companyAddress || '';
            document.getElementById('company-director').value = companySettings.companyDirector || '';
            document.getElementById('company-represented-by').value = companySettings.companyRepresentedBy || 'Nizamnamə';
        }

        // Payroll calculation
        function calculatePayroll(grossSalary) {
            grossSalary = parseFloat(grossSalary) || 0;
            if (grossSalary <= 0) {
                return {
                    employeeDSMF: '0.00',
                    employerDSMF: '0.00',
                    employeeUnemployment: '0.00',
                    employerUnemployment: '0.00',
                    employeeITS: '0.00',
                    employerITS: '0.00',
                    incomeTax: '0.00',
                    netSalary: '0.00',
                    totalEmployerCost: '0.00',
                    totalEmployerContributions: '0.00'
                };
            }

            const MIN_WAGE = 350.00;
            const DSMF_LOWER_LIMIT = 200.00;
            const ITS_UPPER_LIMIT = 8000.00;
            const INCOME_TAX_NON_TAXABLE = 200.00;
            const INCOME_TAX_LOWER_RATE_LIMIT = 2500.00;

            // Continuation of calculatePayroll function
            const employerDSMF = grossSalary <= DSMF_LOWER_LIMIT
                ? grossSalary * 0.07
                : 6.00 + (grossSalary - DSMF_LOWER_LIMIT) * 0.10;

            const employeeUnemployment = grossSalary * 0.005;
            const employerUnemployment = grossSalary * 0.005;

            const employeeITS = grossSalary <= ITS_UPPER_LIMIT
                ? grossSalary * 0.005
                : 40.00;
            const employerITS = grossSalary <= ITS_UPPER_LIMIT
                ? grossSalary * 0.005
                : 40.00;

            let taxableIncome = grossSalary - employeeDSMF - employeeUnemployment - employeeITS;
            let incomeTax = 0;
            if (taxableIncome > INCOME_TAX_NON_TAXABLE) {
                const taxableAmount = taxableIncome - INCOME_TAX_NON_TAXABLE;
                incomeTax = taxableAmount <= INCOME_TAX_LOWER_RATE_LIMIT
                    ? taxableAmount * 0.14
                    : taxableAmount * 0.14 + (taxableAmount - INCOME_TAX_LOWER_RATE_LIMIT) * 0.25;
            }

            const netSalary = grossSalary - employeeDSMF - employeeUnemployment - employeeITS - incomeTax;
            const totalEmployerContributions = employerDSMF + employerUnemployment + employerITS;
            const totalEmployerCost = grossSalary + totalEmployerContributions;

            return {
                employeeDSMF: employeeDSMF.toFixed(2),
                employerDSMF: employerDSMF.toFixed(2),
                employeeUnemployment: employeeUnemployment.toFixed(2),
                employerUnemployment: employerUnemployment.toFixed(2),
                employeeITS: employeeITS.toFixed(2),
                employerITS: employerITS.toFixed(2),
                incomeTax: incomeTax.toFixed(2),
                netSalary: netSalary.toFixed(2),
                totalEmployerCost: totalEmployerCost.toFixed(2),
                totalEmployerContributions: totalEmployerContributions.toFixed(2)
            };
        }

        // Display DSMF calculation preview
        function updateDSMFPreview() {
            const grossSalary = parseFloat(salaryInput.value) || 0;
            const payroll = calculatePayroll(grossSalary);
            let detailsVisible = false;

            if (grossSalary <= 0) {
                dsmfPreview.style.display = 'none';
                return;
            }

            const toggleDetails = document.createElement('span');
            toggleDetails.className = 'toggle-details';
            toggleDetails.textContent = 'Ətraflı göstər';
            toggleDetails.onclick = () => {
                detailsVisible = !detailsVisible;
                taxDetails.style.display = detailsVisible ? 'block' : 'none';
                toggleDetails.textContent = detailsVisible ? 'Ətraflı gizlət' : 'Ətraflı göstər';
            };

            const taxDetails = document.createElement('div');
            taxDetails.className = 'tax-details';
            taxDetails.style.display = 'none';
            taxDetails.innerHTML = `
                <div>İşçinin DSMF: <strong>${payroll.employeeDSMF} ₼</strong></div>
                <div>İşəgötürənin DSMF: <strong>${payroll.employerDSMF} ₼</strong></div>
                <div>İşçinin İşsizlik Sığortası: <strong>${payroll.employeeUnemployment} ₼</strong></div>
                <div>İşəgötürənin İşsizlik Sığortası: <strong>${payroll.employerUnemployment} ₼</strong></div>
                <div>İşçinin İTS: <strong>${payroll.employeeITS} ₼</strong></div>
                <div>İşəgötürənin İTS: <strong>${payroll.employerITS} ₼</strong></div>
                <div>Gəlir Vergisi: <strong>${payroll.incomeTax} ₼</strong></div>
            `;

            dsmfPreview.innerHTML = `
                <div>Xalis Maaş (Təxmini): <strong>${payroll.netSalary} ₼</strong></div>
                <div>İşəgötürənin Ümumi Xərci: <strong>${payroll.totalEmployerCost} ₼</strong></div>
            `;
            dsmfPreview.appendChild(toggleDetails);
            dsmfPreview.appendChild(taxDetails);
            dsmfPreview.style.display = 'block';
        }

        // Debounced salary input event
        let salaryInputTimeout;
        salaryInput.addEventListener('input', () => {
            clearTimeout(salaryInputTimeout);
            salaryInputTimeout = setTimeout(updateDSMFPreview, 500);
        });

        // Render employee table
        function renderEmployeeTable() {
            employeeTableBody.innerHTML = '';
            if (employees.length === 0) {
                employeeTableBody.innerHTML = '<tr><td colspan="8" style="text-align:center;">Heç bir işçi tapılmadı.</td></tr>';
                return;
            }

            employees.forEach(employee => {
                const payroll = calculatePayroll(employee.salary);
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td><strong onclick="showEmployeeDetails('${employee.id}')">${employee.name}</strong></td>
                    <td>${employee.position || '-'}</td>
                    <td>${employee.finCode || '-'}</td>
                    <td>${employee.hireDate ? new Date(employee.hireDate).toLocaleDateString('az-AZ') : '-'}</td>
                    <td class="currency">${employee.salary.toFixed(2)}</td>
                    <td class="currency">${payroll.netSalary}</td>
                    <td class="status-${employee.status}">
                        ${employee.status === 'active' ? 'Aktiv' : 
                          employee.status === 'terminated' ? 'İşdən Çıxarılıb' : 'Məzuniyyətdə'}
                    </td>
                    <td class="actions">
                        <button class="btn btn-sm btn-warning" onclick="editEmployee('${employee.id}')">
                            <i class="fas fa-edit"></i> Redaktə
                        </button>
                        <button class="btn btn-sm btn-success" onclick="generateContract('${employee.id}')">
                            <i class="fas fa-file-pdf"></i> Müqavilə
                        </button>
                        <button class="btn btn-sm btn-danger" onclick="terminateEmployee('${employee.id}')">
                            <i class="fas fa-user-times"></i> İşdən Çıxart
                        </button>
                    </td>
                `;
                employeeTableBody.appendChild(row);
            });
        }

        // Reset employee form
        function resetForm() {
            employeeForm.reset();
            document.getElementById('employee-id').value = '';
            editingEmployeeId = null;
            formTitle.innerHTML = '<i class="fas fa-user-plus"></i> Yeni İşçi Əlavə Et';
            submitBtn.innerHTML = '<i class="fas fa-save"></i> Yadda Saxla';
            cancelEditBtn.style.display = 'none';
            dsmfPreview.style.display = 'none';
            document.getElementById('status').value = 'active';
            document.getElementById('citizenship').value = 'Azərbaycan';
            document.getElementById('work-schedule').value = '5 günlük iş həftəsi, 09:00-18:00';
            document.getElementById('vacation-days').value = '21';
            document.getElementById('trial-period').value = '0';
            employeeForm.scrollIntoView({ behavior: 'smooth' });
        }

        // Cancel edit
        cancelEditBtn.addEventListener('click', resetForm);

        // Edit employee
        window.editEmployee = function(id) {
            const employee = employees.find(emp => emp.id === id);
            if (!employee) return;

            editingEmployeeId = id;
            formTitle.innerHTML = '<i class="fas fa-user-edit"></i> İşçi Məlumatlarını Redaktə Et';
            submitBtn.innerHTML = '<i class="fas fa-save"></i> Yenilə';
            cancelEditBtn.style.display = 'inline-flex';

            document.getElementById('employee-id').value = id;
            document.getElementById('name').value = employee.name || '';
            document.getElementById('fin-code').value = employee.finCode || '';
            document.getElementById('gender').value = employee.gender || 'Kişi';
            document.getElementById('birth-date').value = employee.birthDate || '';
            document.getElementById('passport-series').value = employee.passportSeries || '';
            document.getElementById('passport-issue-date').value = employee.passportIssueDate || '';
            document.getElementById('passport-authority').value = employee.passportAuthority || '';
            document.getElementById('citizenship').value = employee.citizenship || 'Azərbaycan';
            document.getElementById('address-registration').value = employee.addressRegistration || '';
            document.getElementById('address-actual').value = employee.addressActual || '';
            document.getElementById('phone').value = employee.phone || '';
            document.getElementById('email').value = employee.email || '';
            document.getElementById('position').value = employee.position || '';
            document.getElementById('department').value = employee.department || '';
            document.getElementById('hire-date').value = employee.hireDate || '';
            document.getElementById('contract-type').value = employee.contractType || 'Müddətsiz';
            document.getElementById('contract-duration').value = employee.contractDuration || '';
            document.getElementById('trial-period').value = employee.trialPeriod || '0';
            document.getElementById('work-schedule').value = employee.workSchedule || '5 günlük iş həftəsi, 09:00-18:00';
            document.getElementById('vacation-days').value = employee.vacationDays || '21';
            document.getElementById('salary').value = employee.salary || '';
            document.getElementById('iban').value = employee.iban || '';
            document.getElementById('education').value = employee.education || '';
            document.getElementById('marital-status').value = employee.maritalStatus || '';
            document.getElementById('status').value = employee.status || 'active';

            updateDSMFPreview();
            employeeForm.scrollIntoView({ behavior: 'smooth' });
        };

        // Show employee details
        window.showEmployeeDetails = function(id) {
            const employee = employees.find(emp => emp.id === id);
            if (!employee) return;

            modalEmployeeName.textContent = employee.name || 'İşçi Məlumatları';
            const payroll = calculatePayroll(employee.salary);

            modalBodyContent.innerHTML = `
                <div class="detail-grid">
                    <div class="detail-item">
                        <strong>Ad, Soyad, Ata adı</strong>
                        <span>${employee.name || '-'}</span>
                    </div>
                    <div class="detail-item">
                        <strong>FIN Kod</strong>
                        <span>${employee.finCode || '-'}</span>
                    </div>
                    <div class="detail-item">
                        <strong>Cinsi</strong>
                        <span>${employee.gender || '-'}</span>
                    </div>
                    <div class="detail-item">
                        <strong>Doğum Tarixi</strong>
                        <span>${employee.birthDate ? new Date(employee.birthDate).toLocaleDateString('az-AZ') : '-'}</span>
                    </div>
                    <div class="detail-item">
                        <strong>Ş/V Seriya və Nömrə</strong>
                        <span>${employee.passportSeries || '-'}</span>
                    </div>
                    <div class="detail-item">
                        <strong>Ş/V Verilmə Tarixi</strong>
                        <span>${employee.passportIssueDate ? new Date(employee.passportIssueDate).toLocaleDateString('az-AZ') : '-'}</span>
                    </div>
                    <div class="detail-item">
                        <strong>Ş/V Verən Orqan</strong>
                        <span>${employee.passportAuthority || '-'}</span>
                    </div>
                    <div class="detail-item">
                        <strong>Vətəndaşlıq</strong>
                        <span>${employee.citizenship || '-'}</span>
                    </div>
                    <div class="detail-item">
                        <strong>Qeydiyyat Ünvanı</strong>
                        <span>${employee.addressRegistration || '-'}</span>
                    </div>
                    <div class="detail-item">
                        <strong>Faktiki Ünvan</strong>
                        <span>${employee.addressActual || '-'}</span>
                    </div>
                    <div class="detail-item">
                        <strong>Mobil Telefon</strong>
                        <span>${employee.phone || '-'}</span>
                    </div>
                    <div class="detail-item">
                        <strong>Email</strong>
                        <span>${employee.email || '-'}</span>
                    </div>
                    <div class="detail-item">
                        <strong>Vəzifə</strong>
                        <span>${employee.position || '-'}</span>
                    </div>
                    <div class="detail-item">
                        <strong>Struktur Bölməsi</strong>
                        <span>${employee.department || '-'}</span>
                    </div>
                    <div class="detail-item">
                        <strong>İşə Başlama Tarixi</strong>
                        <span>${employee.hireDate ? new Date(employee.hireDate).toLocaleDateString('az-AZ') : '-'}</span>
                    </div>
                    <div class="detail-item">
                        <strong>Müqavilə Növü</strong>
                        <span>${employee.contractType || '-'}</span>
                    </div>
                    <div class="detail-item">
                        <strong>Müqavilə Müddəti</strong>
                        <span>${employee.contractDuration || '-'}</span>
                    </div>
                    <div class="detail-item">
                        <strong>Sınaq Müddəti (ay)</strong>
                        <span>${employee.trialPeriod || '0'}</span>
                    </div>
                    <div class="detail-item">
                        <strong>İş Rejimi</strong>
                        <span>${employee.workSchedule || '-'}</span>
                    </div>
                    <div class="detail-item">
                        <strong>Məzuniyyət Günləri</strong>
                        <span>${employee.vacationDays || '-'}</span>
                    </div>
                    <div class="detail-item">
                        <strong>Brüt Maaş</strong>
                        <span>${employee.salary.toFixed(2)} ₼</span>
                    </div>
                    <div class="detail-item">
                        <strong>Xalis Maaş (Təxmini)</strong>
                        <span>${payroll.netSalary} ₼</span>
                    </div>
                    <div class="detail-item">
                        <strong>Bank Hesabı (IBAN)</strong>
                        <span>${employee.iban || '-'}</span>
                    </div>
                    <div class="detail-item">
                        <strong>Təhsil</strong>
                        <span>${employee.education || '-'}</span>
                    </div>
                    <div class="detail-item">
                        <strong>Ailə Vəziyyəti</strong>
                        <span>${employee.maritalStatus || '-'}</span>
                    </div>
                    <div class="detail-item">
                        <strong>Status</strong>
                        <span class="status-${employee.status}">
                            ${employee.status === 'active' ? 'Aktiv' : 
                              employee.status === 'terminated' ? 'İşdən Çıxarılıb' : 'Məzuniyyətdə'}
                        </span>
                    </div>
                </div>
            `;

            modalEditBtn.onclick = () => editEmployee(id);
            modalContractBtn.onclick = () => generateContract(id);
            modalTerminateBtn.onclick = () => terminateEmployee(id, true);

            employeeDetailModal.style.display = 'block';
        };

        // Close modal
        window.closeModal = function(modalId) {
            document.getElementById(modalId).style.display = 'none';
            modalBodyContent.innerHTML = '<p>Yüklənir...</p>';
        };

        // Tab navigation
        window.openTab = function(evt, tabName) {
            const tabContents = document.getElementsByClassName('tab-content');
            const tabButtons = document.getElementsByClassName('tab-button');

            for (let content of tabContents) {
                content.classList.remove('active');
            }
            for (let button of tabButtons) {
                button.classList.remove('active');
            }

            document.getElementById(tabName).classList.add('active');
            if (evt) {
                evt.currentTarget.classList.add('active');
            } else {
                document.querySelector(`.tab-button[onclick*="${tabName}"]`).classList.add('active');
            }
        };

        // Number to text (for contract)
        function numberToText(number) {
            const ones = ['', 'bir', 'iki', 'üç', 'dörd', 'beş', 'altı', 'yeddi', 'səkkiz', 'doqquz'];
            const tens = ['', 'on', 'iyirmi', 'otuz', 'qırx', 'əlli', 'altmış', 'yetmiş', 'səksən', 'doxsan'];
            const hundreds = ['', 'yüz', 'iki yüz', 'üç yüz', 'dörd yüz', 'beş yüz', 'altı yüz', 'yeddi yüz', 'səkkiz yüz', 'doqquz yüz'];
            const thousands = ['', 'min', 'iki min', 'üç min', 'dörd min', 'beş min', 'altı min', 'yeddi min', 'səkkiz min', 'doqquz min'];

            if (number === 0) return 'sıfır';

            let result = '';
            const integerPart = Math.floor(number);
            const decimalPart = Math.round((number - integerPart) * 100);

            if (integerPart >= 1000) {
                const thousand = Math.floor(integerPart / 1000);
                result += thousands[thousand] + ' ';
                number = integerPart % 1000;
            }
            if (integerPart >= 100) {
                const hundred = Math.floor(integerPart / 100);
                result += hundreds[hundred] + ' ';
                number = integerPart % 100;
            }
            if (integerPart >= 10) {
                const ten = Math.floor(integerPart / 10);
                result += tens[ten] + ' ';
                number = integerPart % 10;
            }
            if (integerPart > 0) {
                result += ones[integerPart] + ' ';
            }

            if (decimalPart > 0) {
                result += 'və ';
                if (decimalPart >= 10) {
                    const ten = Math.floor(decimalPart / 10);
                    result += tens[ten] + ' ';
                    decimalPart = decimalPart % 10;
                }
                if (decimalPart > 0) {
                    result += ones[decimalPart] + ' ';
                }
                result += 'qəpik';
            } else {
                result += 'manat';
            }

            return result.trim();
        }

        // Generate contract PDF
        window.generateContract = async function(id) {
            const employee = employees.find(emp => emp.id === id);
            if (!employee) {
                showError(loginError, 'İşçi tapılmadı!');
                return;
            }
            if (!companySettings.companyName || !companySettings.companyVoen || !companySettings.companyAddress || !companySettings.companyDirector) {
                showError(loginError, 'Müqavilə yaratmaq üçün şirkət məlumatlarını tam doldurun!');
                return;
            }

            showLoading(true);
            try {
                const clone = contractTemplate.cloneNode(true);
                clone.id = 'contract-temp';

                const monthsAZ = ['yanvar', 'fevral', 'mart', 'aprel', 'may', 'iyun', 'iyul', 'avqust', 'sentyabr', 'oktyabr', 'noyabr', 'dekabr'];
                const contractDate = new Date();
                const hireDate = employee.hireDate ? new Date(employee.hireDate) : new Date();
                const contractNumber = `EMP-${id.slice(-5).toUpperCase()}`;
                const grossSalaryText = numberToText(employee.salary);

                const placeholders = {
                    contractNumber,
                    contractDateDay: contractDate.getDate().toString().padStart(2, '0'),
                    contractDateMonth: monthsAZ[contractDate.getMonth()],
                    contractDateYear: contractDate.getFullYear(),
                    companyName: companySettings.companyName,
                    companyVoen: companySettings.companyVoen,
                    companyAddress: companySettings.companyAddress,
                    companyDirector: companySettings.companyDirector,
                    companyRepresentedBy: companySettings.companyRepresentedBy,
                    employeeFullName: employee.name,
                    employeeCitizenship: employee.citizenship || 'Azərbaycan',
                    employeeBirthDate: employee.birthDate ? new Date(employee.birthDate).toLocaleDateString('az-AZ') : '-',
                    employeeGender: employee.gender || '-',
                    employeeFinCode: employee.finCode || '-',
                    employeePassportSeries: employee.passportSeries || '-',
                    employeePassportIssueDate: employee.passportIssueDate ? new Date(employee.passportIssueDate).toLocaleDateString('az-AZ') : '-',
                    employeePassportAuthority: employee.passportAuthority || '-',
                    employeeAddressRegistration: employee.addressRegistration || '-',
                    employeeAddressActual: employee.addressActual || '-',
                    employeePosition: employee.position || '-',
                    employeeDepartment: employee.department || '-',
                    hireDate: hireDate.toLocaleDateString('az-AZ'),
                    contractDurationText: employee.contractType || 'Müddətsiz',
                    contractDurationValue: employee.contractDuration || '-',
                    contractTermDisplay: employee.contractType === 'Müddətli' ? 'block' : 'none',
                    trialPeriod: employee.trialPeriod || '0',
                    workSchedule: employee.workSchedule || '5 günlük iş həftəsi, 09:00-18:00',
                    vacationDays: employee.vacationDays || '21',
                    grossSalaryFormatted: employee.salary.toFixed(2),
                    grossSalaryText,
                    employeeIban: employee.iban || '-'
                };

                Object.keys(placeholders).forEach(key => {
                    const elements = clone.querySelectorAll(`[data-field="${key}"]`);
                    elements.forEach(el => {
                        if (key === 'contractTermDisplay') {
                            const parent = el.parentElement;
                            if (parent) parent.style.display = placeholders[key];
                        } else {
                            el.textContent = placeholders[key];
                        }
                    });
                });

                document.body.appendChild(clone);
                const opt = {
                    margin: 0,
                    filename: `${employee.name.replace(/\s+/g, '_')}_Emek_Muqavilesi.pdf`,
                    image: { type: 'jpeg', quality: 0.98 },
                    html2canvas: { scale: 2, useCORS: true },
                    jsPDF: { unit: 'mm', format: 'a4', orientation: 'portrait' }
                };

                await html2pdf().set(opt).from(clone).save();
                document.body.removeChild(clone);
                showSuccess('Müqavilə PDF olaraq yükləndi.');
            } catch (error) {
                console.error('PDF generation error:', error);
                showError(loginError, `Müqavilə yaradılarkən xəta: ${error.message}`);
            } finally {
                showLoading(false);
            }
        };

        // Show success message
        function showSuccess(message) {
            const tempDiv = document.createElement('div');
            tempDiv.style.cssText = `
                position: fixed;
                bottom: 20px;
                right: 20px;
                background: var(--success-color);
                color: var(--white-color);
                padding: 12px 24px;
                border-radius: var(--border-radius);
                box-shadow: var(--box-shadow);
                z-index: 10000;
                font-size: 0.95rem;
                display: flex;
                align-items: center;
                gap: 8px;
                animation: slideIn 0.5s ease, slideOut 0.5s ease 4.5s;
            `;
            tempDiv.innerHTML = `<i class="fas fa-check-circle"></i> ${message}`;
            document.body.appendChild(tempDiv);

            setTimeout(() => {
                if (tempDiv.parentNode) {
                    tempDiv.remove();
                }
            }, 5000);

            const style = document.createElement('style');
            style.textContent = `
                @keyframes slideIn {
                    from { transform: translateX(100%); opacity: 0; }
                    to { transform: translateX(0); opacity: 1; }
                }
                @keyframes slideOut {
                    from { transform: translateX(0); opacity: 1; }
                    to { transform: translateX(100%); opacity: 0; }
                }
            `;
            document.head.appendChild(style);
            setTimeout(() => style.remove(), 5000);
        }

        // Initialize form validations
        function initializeFormValidations() {
            const inputs = employeeForm.querySelectorAll('input, select, textarea');
            inputs.forEach(input => {
                input.addEventListener('invalid', (e) => {
                    e.preventDefault();
                    showError(loginError, `${input.parentElement.querySelector('label').textContent} düzgün doldurulmalıdır.`);
                    input.focus();
                });
                input.addEventListener('change', () => {
                    if (input.checkValidity()) {
                        input.style.borderColor = '';
                    } else {
                        input.style.borderColor = 'var(--danger-color)';
                    }
                });
            });
        }

        // Initialize
        initializeFormValidations();
        updateDSMFPreview();
    </script>
</body>
</html>